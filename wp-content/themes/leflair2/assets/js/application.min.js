"use strict";var ApplicationConfiguration=function(){var applicationModuleName="leflair",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","angularMoment","timer","ui.select","angulartics","angulartics.google.tagmanager","angular-loading-bar","angularPayments","hmTouchEvents","duScroll"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0),$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("carousel"),ApplicationConfiguration.registerModule("cart"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("pages"),ApplicationConfiguration.registerModule("product"),ApplicationConfiguration.registerModule("sale"),ApplicationConfiguration.registerModule("users"),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-right"></span></a>\n</div>\n')}]),angular.module("carousel").directive("promotionCarousel",["$timeout","$animate","Promotions",function($timeout,$animate,Promotions){return{templateUrl:"/modules/carousel/views/promotion-carousel.client.view.html",transclude:!0,restrict:"E",link:function(scope,element,attrs){scope.slides=Promotions.getSlides()}}}]),angular.module("carousel").factory("Promotions",[function(){return{interval:5e3,getSlides:function(){return[{text:"Guaranteed Genuine Products"},{text:"Got a question? Call us at 1900 6710",action:"tel:19006710"}]}}}]),angular.module("cart").config(["$stateProvider",function($stateProvider){$stateProvider.state("shipping",{url:"/cart/shipping",templateUrl:"/modules/cart/views/shipping.client.view.html",controller:"ShippingController",resolve:{userInfo:["Account",function(Account){return Account.get().$promise}],addressType:function(){return"shipping"}}}).state("shipping.edit",{url:"/edit/:addressId",views:{"content@shipping":{templateUrl:"/modules/cart/views/shipping.edit.client.view.html",controller:"AddressController",resolve:{addressId:["$stateParams","userInfo","addressType",function($stateParams,userInfo,addressType){return $stateParams.addressId?$stateParams.addressId:void 0}]}}}}).state("billing",{url:"/cart/billing",templateUrl:"/modules/cart/views/shipping.client.view.html",controller:"ShippingController",resolve:{userInfo:["Account",function(Account){return Account.get().$promise}],addressType:function(){return"billing"}}}).state("billing.edit",{url:"/edit/:addressId",views:{"content@billing":{templateUrl:"/modules/cart/views/shipping.edit.client.view.html",controller:"AddressController",resolve:{addressId:["$stateParams",function($stateParams){return $stateParams.addressId?$stateParams.addressId:void 0}]}}}}).state("checkout",{url:"/cart/checkout",templateUrl:"/modules/cart/views/checkout.client.view.html",controller:"CheckoutController",resolve:{account:["Account",function(Account){return Account.get().$promise}],validateAddress:["account","$state","AddressHelper",function(account,$state,AddressHelper){account.address.shipping&&AddressHelper.isAddressValid(account.address.shipping[0]).status?account.address.billing&&AddressHelper.isAddressValid(account.address.billing[0]).status||$state.go("billing"):$state.go("shipping")}],items:["Cart","$location","analysis",function(Cart,$location,analysis){return Cart.getItems().$promise.then(function(items){return items.length?items:void $location.path("/cart")})}],orderId:["$location",function($location){var params=$location.search();return params.Ref?params.Ref:null}],creditCards:["$creditCard",function($creditCard){return $creditCard.list().then(function(response){return response.data.cards},function(err){return[]})}]}}).state("success",{url:"/cart/success/:orderCode",templateUrl:"/modules/cart/views/success.client.view.html",controller:"SuccessController",resolve:{code:["$stateParams","$location",function($stateParams,$location){return $stateParams.orderCode?$stateParams.orderCode:void $location.path("/cart")}],account:["Account",function(Account){return Account.get().$promise}],recommendations:["code","Products",function(code,Products){return Products.recommendationsFromOrder({orderCode:code}).$promise}]}})}]),angular.module("cart").controller("CheckoutController",["$scope","$state","$breakpoint","items","account","$order","orderId","creditCards","analysis","Account","Cart","$q","$rootScope","$filter","$location","Address","AddressHelper",function($scope,$state,$breakpoint,items,account,$order,orderId,creditCards,analysis,Account,Cart,$q,$rootScope,$filter,$location,Address,AddressHelper){function setShipping(billingItems,amount){var filterItems=$filter("filter")(billingItems,{name:"!Shipping"});return filterItems.push({name:"Shipping",amount:amount}),filterItems}function validateData(){return AddressHelper.isAddressValid($scope.order.address.shipping).status?AddressHelper.isAddressValid($scope.order.address.billing).status?!0:($scope.error="Please verify your billing address",!1):($scope.error="Please verify your shipping address",!1)}function validatePaymentMethod(){if("CC"===$scope.order.paymentSummary.method){if(angular.equals({},$scope.cardOps.selectedCard))return $scope.error="Please select a credit card",!1;if($scope.cardOps.isCreateCard){var result=$scope.cardOps.validateNewCard($scope.cardList);return result?($scope.cardOps.selectedCard=result,!0):($scope.error="Please verify your new credit card again",!1)}if(!$scope.cardOps.selectedCard.cvv)return $scope.error="Please enter CVV number",!1}return!0}function checkoutCOD(order){return Cart.checkoutCOD(order)}function checkoutCC(order){$scope.order.paymentSummary.card=$scope.cardOps.selectedCard;var deferred=$q.defer();return Cart.validateCC(order).then(function(transaction){$scope.transaction=transaction,$scope.onCheckoutCC()},function(err){deferred.reject(err)}),deferred.promise}function checkoutFREE(order){return Cart.checkoutFREE(order)}function getCheckoutMethod(order){switch(order.paymentSummary.method){case"CC":return checkoutCC(order);case"COD":return checkoutCOD(order);case"FREE":return checkoutFREE(order)}}function calculateBills(){var totalNoGiftcard=$scope.itemSubtotal;if(angular.forEach($scope.billingItems,function(billingItem){"Account Credit"!==billingItem.name&&(totalNoGiftcard+=billingItem.amount)}),$scope.account.availableCredit>0){var creditIndex=-1;for(var index in $scope.billingItems)if("Account Credit"===$scope.billingItems[index].name){creditIndex=index;break}var credit={name:"Account Credit",amount:-($scope.account.availableCredit<totalNoGiftcard?$scope.account.availableCredit:totalNoGiftcard)};-1===creditIndex?$scope.billingItems.push(credit):$scope.billingItems[creditIndex]=credit}}var SHIPPING_FEE=25e3;if($scope.$breakpoint=$breakpoint,$scope.Cart=Cart,$scope.cardOps={saveCard:!0},$scope.selectCard=function(card,isNew){isNew?($scope.cardOps.selectedCard={},$scope.cardOps.isCreateCard=!0):($scope.cardOps.selectedCard=card,$scope.cardOps.isCreateCard=!1),$scope.cardOps.resetForm&&$scope.cardOps.resetForm(),$scope.showMenu=!$scope.showMenu},$scope.selectPaymentMethod=function(type){switch($scope.order.paymentSummary.method=type||"CC",type){case"CC":$scope.billingItems=setShipping($scope.billingItems,0);break;case"COD":$scope.billingItems=setShipping($scope.billingItems,SHIPPING_FEE);break;case"FREE":$scope.billingItems=setShipping($scope.billingItems,0)}},$scope.getTotal=function(){var runningTotal=$scope.itemSubtotal;return angular.forEach($scope.billingItems,function(billingItem){runningTotal+=billingItem.amount}),runningTotal>0?runningTotal:0},$scope.removeCard=function(){$scope.cardOps.selectedCard=null,$scope.cardOps.isCreateCard=!1},$scope.calculateTotals=function(){$scope.itemSubtotal=$scope.items.reduce(function(subtotal,item){return subtotal+=item.totalSalePrice},0),$scope.savings=$scope.items.reduce(function(savings,item){return savings+=item.totalRetailPrice-item.totalSalePrice},0)},$scope.items=items,$scope.$watch("items",function(){$scope.calculateTotals(),calculateBills(),0===$scope.getTotal()?$scope.selectPaymentMethod("FREE"):$scope.selectPaymentMethod("CC")},!0),$scope.billingItems=[],$scope.order={address:{},paymentSummary:{},agree:!1},$scope.cardList=creditCards,$scope.cardList.length?$scope.cardOps.paymentType=$scope.cardOps.selectedCard=$scope.cardList[0]:($scope.cardOps.paymentType="CC",$scope.selectCard(null,!0)),orderId){$scope._progress=!0;var productsData=angular.copy($scope.items);$order.getCheckoutOrder(orderId).success(function(response){$scope._progress=!1,"success"===response.status&&(response.confirmed||(Cart.getItems(!0),$rootScope.$broadcast("updateCredit"),analysis.checkoutSuccess(response.order,productsData)),$state.go("success",{orderCode:orderId}))}).error(function(response){$scope._progress=!1,$scope.topError=response.message})}$scope.account=account,$scope.isSameAddress=AddressHelper.isSameAddress($scope.account.address.shipping[0],$scope.account.address.billing[0]),angular.isDefined($scope.account.address)&&($scope.order.address={billing:angular.copy($scope.account.address.billing[0]),shipping:angular.copy($scope.account.address.shipping[0])}),validateData(),$scope.$on("updateCredit",function(){Account.get(function(user){$scope.account.availableCredit=user.availableCredit,$scope.billingItems=setShipping($scope.billingItems,0),calculateBills(),0===$scope.getTotal()&&$scope.items.length>0?$scope.selectPaymentMethod("FREE"):$scope.selectPaymentMethod($scope.order.paymentSummary.method),validateData()})}),$scope.checkout=function(){if(validateData()&&validatePaymentMethod($scope.order,$scope.cardOps.selectedCard)){$scope.order.items=$scope.items;var productsData=angular.copy($scope.items);$scope.order.billingItems=$scope.billingItems,$scope.order.total=$scope.getTotal(),$scope.order.agree=!0,$scope.order.options={saveCard:$scope.cardOps.saveCard},$scope._progress=!0,$scope.error=!1;var promise=getCheckoutMethod($scope.order);promise.then(function(order){$scope._progress=!1,$scope.items=Cart.getItems(!0),analysis.checkoutSuccess(order,productsData),$scope.items.$promise.then(function(){$rootScope.$broadcast("updateCredit"),$state.go("success",{orderCode:order.code})})},function(errorResponse){$scope._progress=!1,$scope.error=errorResponse.data.message,errorResponse.data.reloadItems===!0&&($scope.items=Cart.getItems(!0),$scope.items.$promise.then($scope.calculateTotals),$scope.items.$promise.then(calculateBills))})}},$scope.successMessage=function(order){$scope.isSuccess=!0,$scope.checkoutOrders=order},$scope.removeCard=function(){$scope.cardOps.selectedCard=null,$scope.cardOps.isCreateCard=!1},$scope.option={},$scope.option.isRedeem=!1,$scope.applyVoucherGiftcard=function(voucher){$scope.option.isRedeem=!1,void 0!==voucher&&($scope.order._showVoucher=!$scope.order._showVoucher,$scope.order.paymentSummary.voucher=voucher,$scope.billingItems.push({name:"Voucher",amount:-voucher.amount}),calculateBills(),$scope.getTotal()<=0&&$scope.items.length>0&&$scope.selectPaymentMethod("FREE"))}}]),angular.module("cart").controller("ShippingController",["$scope","$state","userInfo","addressType","AddressHelper",function($scope,$state,userInfo,addressType,AddressHelper){userInfo.address[addressType]&&userInfo.address[addressType].length?($scope.user=userInfo,$scope.addressType=addressType,$scope.AddressHelper=AddressHelper,$scope.addresses=$scope.user.address[addressType],$scope.addressOps={activeAddress:$scope.addresses[0]}):$state.go(addressType+".edit",{addressId:"new"}),$scope.selectAddress=function(addr){$scope.addressOps.activeAddress=addr},$scope.submit=function(){var newAddressList=$scope.addresses.filter(function(addr){return!angular.equals(addr,$scope.addressOps.activeAddress)});newAddressList.unshift($scope.addressOps.activeAddress),userInfo.address[addressType]=newAddressList,userInfo.$update().then(function(){$state.go("checkout")})}}]),angular.module("cart").controller("AddressController",["$scope","$state","$breakpoint","regex","addressId","userInfo","addressType","AddressHelper",function($scope,$state,$breakpoint,regex,addressId,userInfo,addressType,AddressHelper){function loadDistricts(id,type){AddressHelper.loadDistricts(id).then(function(data){$scope.districts[type]=AddressHelper.prepareName(data)})}$scope.regex=regex,$scope.$breakpoint=$breakpoint,$scope.addressType=addressType,$scope.districts={},$scope.options={differentAddress:null},$scope.selectCity=function(item,type){$scope.address[type].district=null,$scope.districts[type]=null,$scope.address[type].city=item,loadDistricts(item.id,type)},$scope.selectDistrict=function(item,type){$scope.address[type].district=item},$scope.update=function(valid){$scope.error=null,$scope.isSubmitted=!0,valid&&($scope.isPending=!0,userInfo.address[addressType]=userInfo.address[addressType]?userInfo.address[addressType]:[],$scope.isNewAddress?userInfo.address[addressType].unshift($scope.address[addressType]):userInfo.address[addressType][addressId]=$scope.address[addressType],$scope.isNewAddress&&(userInfo.address.billing=userInfo.address.billing?userInfo.address.billing:[],$scope.options.differentAddress?userInfo.address.billing.unshift($scope.address.billing):"shipping"===addressType&&userInfo.address.billing.unshift($scope.address.shipping)),userInfo.$update().then(function(data){userInfo=data,$scope.isPending=!1,$scope.isSubmitted=!1,$state.go("checkout",{},{reload:!0})},function(err){$scope.isPending=!1,$scope.error=err}))},$scope.address={},"new"===addressId?$scope.isNewAddress=!0:($scope.address[addressType]=angular.copy(userInfo.address[addressType][addressId]),$scope.address[addressType].city&&loadDistricts($scope.address[addressType].city.id,addressType)),$scope.provinces=AddressHelper.getProvinces()}]),angular.module("cart").controller("SuccessController",["$scope","$window","code","account","recommendations",function($scope,$window,code,account,recommendations){$scope.code=code,$scope.account=account,$scope.recommendations=recommendations}]),angular.module("cart").directive("checkoutCreditCard",["$sce","$timeout",function($sce,$timeout){return{restrict:"E",templateUrl:"/modules/cart/views/checkoutCreditCard.client.view.html",scope:{order:"=",transaction:"=",onCheckout:"="},link:function(scope,elm,attrs){elm.css("display","none");var btnElm=elm.find("button");scope.onCheckout=function(){$timeout(function(){btnElm[0].click()})},scope.getUrl=function(url){return $sce.trustAsResourceUrl(url)}}}}]),angular.module("cart").directive("creditCard",[function(){return{restrict:"E",templateUrl:"/modules/cart/views/creditCard.client.view.html",scope:{card:"=",onValidate:"=",onReset:"="},controller:["$scope","$creditCard",function($scope,regex,month,$creditCard){function getCardType(type){switch(type){case"visa":return"VISA";case"mastercard":return"Master";case"jcb":return"JCB";case"amex":return"AMEX";default:return null}}$scope.onReset=function(){$scope.err=null,$scope.creditCardForm.$setPristine(),$scope.isSubmitted=!1},$scope.onValidate=function(cardList){if($scope.isSubmitted=!0,$scope.success=null,!$scope.creditCardForm.$valid)return!1;if($scope.err=null,$scope.card.accountType=getCardType($scope.accountType),!$scope.card.accountType)return $scope.err="We don't support this type of credit card",!1;if(cardList){for(var lastDigits=$scope.card.number.slice(-4),i=0;i<cardList.length;++i)if(cardList[i].lastDigits===lastDigits&&cardList[i].accountType===$scope.card.accountType){$scope.err="You have already entered this card. Please select it from the list above";break}if($scope.err)return!1}return $scope.card.expiredMonth=parseInt($scope.expiry.split("/")[0]),$scope.card.expiredYear=$scope.expiry.split("/")[1],$scope.card.expiredYear=2===$scope.card.expiredYear.length?2e3+parseInt($scope.card.expiredYear):parseInt($scope.card.expiredYear),$scope.card.cvv=$scope.cvv,$scope.card}}],link:function(scope,elm,attrs){}}}]),angular.module("cart").directive("shoppingCart",["$timeout","$compile","Cart","$templateRequest","jquery","Authentication",function($timeout,$compile,Cart,$templateRequest,$,Authentication){return{restrict:"E",controller:["$scope","$state","Cart","$timeout","$location","Account","AddressHelper","analysis",function($scope,$state,Cart,$timeout,$location,Account,AddressHelper,analysis){Authentication.user?Account.get():null;$scope.billingItems=[{name:"Shipping",amount:0}],$scope.$on("updateCredit",function(){$scope.items=Cart.getItems(!0)}),$scope.checkout=function(){$scope.showSidebar(),$state.go("checkout")},$scope.removeItem=function(item){$scope.error=!1,item._progress=!0,Cart.removeItem(item,null,function(errorResponse){item._progress=!1,500===errorResponse.status?($scope.error="An error occured: an item has been removed from your bag",Cart.doRemoveItem(item)):$scope.error="Error removing item"})},$scope.updateItemQuantity=function(item){$scope.error=!1,item._progress=!0,Cart.updateItemQuantity(item,function(data){item._progress=!1,item=data,item.quantities=[];for(var i=1;i<=item.product.quantity;i+=1)item.quantities.push(i)},function(errorResponse){item._progress=!1,500===errorResponse.status?($scope.error="An error occured: an item has been removed from your bag",Cart.doRemoveItem(item)):$scope.error="Error updating item"})},$scope.getSubTotal=function(){return $scope.items.reduce(function(subtotal,item){return subtotal+=item.totalSalePrice},0)},$scope.getSavings=function(){return $scope.items.reduce(function(savings,item){return savings+=item.totalRetailPrice-item.totalSalePrice},0)},$scope.getTotal=function(){var runningTotal=$scope.getSubTotal();return angular.forEach($scope.billingItems,function(billingItem){runningTotal+=billingItem.amount}),runningTotal},$scope.updateAnalysis=function(){analysis.viewBasket($scope.items)}}],link:function(scope,elm,attrs){var ESCAPE_KEY=27,cartElm=$('<ui-sidebar on-toggle="showSidebar" on-hide="hideSidebar" class="shopping-cart" template="template" position="right"> </ui-sidebar>');if(Authentication.user){var doShowSideBar=function(highlightedItem){scope.highlightedItem=highlightedItem,scope.showSidebar(),scope.updateAnalysis()};$templateRequest("/modules/cart/views/shoppingCart.client.view.html").then(function(html){scope.template=html,scope.items=Cart.getItems(),$(elm).append($compile(cartElm)(scope)),$timeout(function(){Cart.putCartObj({toggle:doShowSideBar,close:scope.hideSidebar}),$(document).on("keyup",function(evt){evt.keyCode===ESCAPE_KEY&&Cart.close()})})})}}}}]),angular.module("cart").directive("uiVoucher",[function(){return{restrict:"E",templateUrl:"/modules/cart/views/voucher.client.view.html",scope:{voucher:"=",closeTrigger:"&"},controller:["$rootScope","$scope","Vouchers",function($rootScope,$scope,Vouchers){var postRedeem=$scope.closeTrigger();$scope.verify=function(valid){return valid?($scope.error=!1,$scope.__progress=!0,void Vouchers.get($scope.code).then(function(response){$scope.__progress=!1,postRedeem(response.data)},function(errorResponse){$scope.__progress=!1,$scope.error=errorResponse.data.message})):void($scope.error="Voucher is not valid")}}],link:function(scope,elm,attrs){scope.isLargeForm="isLarge"in attrs}}}]),angular.module("cart").directive("uiVouchergiftcard",[function(){return{restrict:"E",templateUrl:"/modules/cart/views/vouchergiftcard.client.view.html",scope:{availCredit:"=",closeTrigger:"&"},controller:["$rootScope","$scope","GiftCard","Vouchers","regex",function($rootScope,$scope,GiftCard,Vouchers,regex){$scope.regex=regex,$scope.verify=function(valid){return valid?($scope.error=!1,$scope.__progress=!0,$scope.code=$scope.code.toUpperCase(),$scope.closeTrigger()(),void GiftCard.get({giftCardCode:$scope.code},function(giftCard){$scope.__progress=!1,$scope.giftCard=giftCard},function(errorResponse){return $scope.error=!1,$scope.__progress=!0,$scope.voucher?($scope.__progress=!1,$scope.error="You can only use one voucher for this order",void($scope.code="")):void Vouchers.get($scope.code).then(function(response){$scope.__progress=!1,$scope.voucher=response.data,$scope.code="",$scope.closeTrigger()(response.data)},function(errorResponse){$scope.__progress=!1,$scope.error=errorResponse.data.message})})):void($scope.error="Gift Card is not valid")},$scope.redeem=function(){$scope.giftCard.$use(function(){$scope.__progress=!1,$rootScope.$broadcast("updateCredit"),$scope.availCredit=$scope.availCredit+$scope.giftCard.amount,$scope.giftCard=null},function(errorResponse){$scope.error=errorResponse.data.message})}}],link:function(scope,elm,attrs){scope.isLargeForm="isLarge"in attrs}}}]),angular.module("cart").factory("CartItems",["$resource",function($resource){return $resource("/api/v1/cart/items/:cartItemId",{cartItemId:"@_id"},{update:{method:"PUT"},checkoutCOD:{method:"POST",url:"/api/v1/cart/checkout/COD"},checkoutCC:{method:"POST",url:"/api/v1/cart/checkout/CC"}})}]),angular.module("cart").factory("Cart",["CartItems","$filter","$rootScope","$creditCard",function(CartItems,$filter,$rootScope,$creditCard){function updateQuantitiesList(list){angular.forEach(list,function(item){item.quantities=[];for(var i=1;i<=item.product.quantity&&(item.quantities.push(i),5!==i);i+=1);})}function validateItemQuantity(item){for(var existing=null,i=0;i<items.length;++i)if(items[i].product._id===item.product&&angular.equals(items[i].variation,item.variation)){existing=items[i];break}if(existing){if(existing.quantity+item.quantity<=existing.product.quantity)return;return{item:existing,maximumQuantity:!0,message:"Maximum quantity for this product already reached"}}}var Cart={},items=null,_cartObj=null;return Cart.putCartObj=function(obj){_cartObj=obj},Cart.toggle=function(hightlighedItem){_cartObj.toggle(hightlighedItem)},Cart.close=function(){_cartObj.close()},Cart.getItems=function(reload){return null!==items&&reload!==!0||(items=CartItems.query(),$rootScope.$broadcast("cartReload")),items.$promise.then(function(){updateQuantitiesList(items)}),items},Cart.addItem=function(newItem,successCB,errorCB){var result=validateItemQuantity(newItem);if(result)return errorCB(result);var item=new CartItems(newItem);return item.$save(function(){items.$promise.then(function(){var existing=$filter("filter")(items,{_id:item._id});existing=existing.length>0?existing[0]:!1,existing?(existing.quantity=item.quantity,existing.totalRetailPrice=item.totalRetailPrice,existing.totalSalePrice=item.totalSalePrice):items.push(item),updateQuantitiesList(items),"function"==typeof successCB&&successCB(item)},errorCB)})},Cart.doRemoveItem=function(item){items.splice(items.indexOf(item),1)},Cart.removeItem=function(item,successCB,errorCB){item.$remove(function(){Cart.doRemoveItem(item),"function"==typeof successCB&&successCB()},errorCB)},Cart.updateItemQuantity=function(item,successCB,errorCB){item.$update(function(response){updateQuantitiesList(items),"function"==typeof successCB&&successCB(response)},errorCB)},Cart.validateCC=function(order){var validateOrder=angular.copy(order);return delete validateOrder.paymentSummary.card.accountType,delete validateOrder.paymentSummary.card.number,delete validateOrder.paymentSummary.card.expiredMonth,delete validateOrder.paymentSummary.card.expiredYear,CartItems.checkoutCC(validateOrder).$promise},Cart.checkoutCOD=function(order){return CartItems.checkoutCOD(order).$promise},Cart.checkoutFREE=function(order){return CartItems.checkoutCOD(order).$promise},Cart}]),angular.module("cart").service("$creditCard",["$http",function($http){this.list=function(){return $http.get("/api/v1/credit-cards")}}]),angular.module("cart").service("$order",["$http",function($http){this.getCheckoutOrder=function(orderId){return $http.get("/ap1/v1/credit-card/checkout/"+orderId)}}]),angular.module("cart").factory("Vouchers",["$http",function($http){return{get:function(voucherCode){return $http.get("/api/v1/vouchers/"+voucherCode)}}}]);var originalLink=angular.copy(window.location.href);angular.module("core").run(["$location","$state","Authentication","Campaign","$rootScope","$window",function($location,$state,Authentication,Campaign,$rootScope,$window){var allowedURLRegex=/\/signin|\/signup|\/reset/;$rootScope.$on("$stateChangeStart",function(e,toState){Authentication.user||Campaign.isCampaignState(toState)||allowedURLRegex.test(toState.url)!==!1||$location.path("/signin")}),$rootScope.reload=function(){$window.location.href=originalLink}}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){var campaignList=window.campaign;angular.forEach(campaignList,function(campaign){$stateProvider.state(campaign,{url:"/"+campaign,resolve:{campaign:["Campaign","Authentication","Account","$state","$rootScope",function(Campaign,Authentication,Account,$state,$rootScope){Campaign.searchCampaign(campaign).then(function(data){$rootScope.campaign=data,Authentication.user?Account.get().$promise.then(function(user){if(user.campaigns=user.campaigns?user.campaigns:[],user.campaigns.indexOf(data.id)<0){user.campaigns.push(data.id);user.$update().then(function(){$state.go("sale-list",{},{reload:!0})})}else $state.go("sale-list")}):$state.go("signin")})}]}})})}]),angular.module("core").factory("checkoutView",["$location",function($location){function isCheckoutStage(){return _list.some(function(view){return $location.$$path.match(new RegExp(view))})}var _list=["/cart","/cart/shipping","cart/checkout"];return{isCheckoutStage:isCheckoutStage}}]),angular.module("core").config(["$compileProvider","$stateProvider","$urlRouterProvider",function($compileProvider,$stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$compileProvider.debugInfoEnabled(!0)}]),angular.module("core").constant("ViewsWithoutHeaders",["/signin","/signup","/reset"]),angular.module("core").controller("FooterController",["$scope","checkoutView",function($scope,checkoutView){$scope.checkoutView=checkoutView}]),angular.module("core").controller("HeaderController",["$scope","Authentication","$rootScope","ViewsWithoutHeaders","checkoutView","$location","$http","$window","Cart","Account","Language",function($scope,Authentication,$rootScope,ViewsWithoutHeaders,checkoutView,$location,$http,$window,Cart,Account,Language){var _account;$scope.Cart=Cart,$scope.checkoutView=checkoutView,$scope.authentication=Authentication,$scope.languageList=Language.getList(),$scope.setLanguage=function(id,reload){$scope.currentLanguage=Language.getLanguage(id),Language.setDefaultLanguage(id),reload&&(_account?(_account.language=id,_account.$update(function(){$window.location.reload()})):$window.location.reload())},Authentication.user?($scope.cartItems=Cart.getItems(),Account.get().$promise.then(function(account){_account=account,$scope.setLanguage(Language.getLanguage().id)})):$scope.setLanguage(Language.getLanguage().id),$scope.$on("cartReload",function(){$scope.cartItems=Cart.getItems()}),$scope.$on("updateCredit",function(){Account.get(function(user){Authentication.user.availableCredit=user.availableCredit})}),$scope.availableCredit=function(){return Authentication.user?Math.floor(Authentication.user.availableCredit/1e3):""},$scope.showHeaderFn=function(){return""!==Authentication.user&&!ViewsWithoutHeaders.some(function(view){return $location.$$path.match(new RegExp(view))})},$scope.logout=function(){$http.get("/api/v1/auth/signout").then(function(){Authentication.user=null,$window.location.reload("/signin")})},$scope.closeSidebar=function(link){link&&$location.path(link),$scope.showSidebar()}}]),angular.module("core").directive("breakpoint",["$window","$breakpoint",function($window,$breakpoint){return{restrict:"A",link:function(scope,element,attr){function broadcastEvent(oldClass){$breakpoint.setClass(scope.breakpoint,oldClass)}function setWindowSize(){scope.breakpoint.windowSize=$window.innerWidth,scope.$$phase||scope.$apply()}function setClass(windowWidth){var _setClass=breakpoints[0]["class"];for(var index in breakpoints)breakpoints[index].lowerBound<windowWidth&&(_setClass=breakpoints[index]["class"]);scope.breakpoint["class"]=_setClass,scope.$$phase||scope.$apply()}scope.breakpoint={"class":"",windowSize:$window.innerWidth};var breakpoints=$breakpoint.getList(),firstTime=!0;angular.element($window).bind("resize",setWindowSize),scope.$watch("breakpoint.windowSize",function(windowWidth,oldValue){setClass(windowWidth)}),scope.$watch("breakpoint.class",function(newClass,oldClass){(newClass!==oldClass||firstTime)&&(broadcastEvent(oldClass),firstTime=!1)})}}}]),angular.module("core").directive("disableAnimate",["$animate","$timeout",function($animate,$timeout){return{restrict:"A",link:function(scope,element,attrs){$timeout(function(){$animate.enabled(!1,element)})}}}]),angular.module("core").directive("keepRatio",["$timeout","$window","jquery",function($timeout,$window,$){return{restrict:"A",link:function(scope,element,attrs){function doResize(){var width=$(element).innerWidth();$(element).css("height",(width-2*parseFloat(attrs.hasPadding))/parseFloat(attrs.keepRatio)+"px")}$timeout(function(){doResize(),angular.element($window).bind("resize",function(){doResize()})})}}}]),angular.module("core").directive("leScroll",["$document","$window","$timeout","jquery",function($document,$window,$timeout,$){return{restrict:"A",link:function(scope,element,attrs){var offset=attrs.offset||400;attrs.scrollTarget?$timeout(function(){element.bind("click",function(){var targetElm=$document[0].getElementById(attrs.scrollTarget);$document.scrollToElementAnimated(targetElm,parseInt(offset))})}):element.ready(function(){$document.scrollToElementAnimated(element,parseInt(offset))})}}}]),angular.module("core").directive("rio",["$window","$timeout","$breakpoint","jquery",function($window,$timeout,$breakpoint,$){return{priority:99,restrict:"A",scope:{rioCropFocus:"=?",trigger:"=?"},link:function(scope,element,attrs){function reloadImg(){$window.ResponsiveIO.refresh(element)}if(scope.rioCropFocus&&scope.$watch(function(){return $breakpoint.getClass()},function(){var cropValue;angular.forEach(scope.rioCropFocus,function(value,key){$breakpoint.availFrom(key)&&(cropValue=value)}),element.attr("data-crop-focus",cropValue)}),angular.isDefined(scope.trigger))var watchInstance=scope.$watch("trigger",function(value){value&&(reloadImg(),watchInstance())});else attrs.$observe("bgSrc",function(value){value&&reloadImg()}),attrs.$observe("src",function(value){value&&reloadImg()})}}}]),angular.module("core").directive("signupLink",["Authentication","$modal",function(Authentication,$modal){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(e){if(!Authentication.user){e.preventDefault();$modal.open({templateUrl:"/modules/users/views/signup-modal.client.view.html",controller:"SignupModalController",size:"signup"})}})}}}]),angular.module("core").directive("leStickyContainer",["$window","$document","$timeout","$compile","$breakpoint",function($window,$document,$timeout,$compile,$breakpoint){
return{restrict:"A",scope:{activeWhen:"@?"},controller:["$scope",function($scope){$scope.childElms=[],$scope.placeholderElms=[],$scope.enablePlaceholder=function(index){$scope.placeholderElms[index].addClass("sticky-placeholder-enable")},$scope.disablePlaceholder=function(index){$scope.placeholderElms[index].removeClass("sticky-placeholder-enable")},$scope.setChildFixed=function(index){$scope.childElms[index].addClass("sticky-enable"),$scope.enablePlaceholder(index)},$scope.removeChildFixed=function(index){$scope.childElms[index].removeClass("sticky-enable"),$scope.disablePlaceholder(index)},$scope.getTargetElm=function(index){return $scope.childElms[index].hasClass("sticky-enable")?$scope.placeholderElms[index]:$scope.childElms[index]},this.addChild=function(element){$scope.childElms.push(element);var placeholderElm=element.clone();placeholderElm.removeAttr("le-sticky"),placeholderElm.addClass("sticky-placeholder"),$compile(placeholderElm.contents())($scope),element.after(placeholderElm),$scope.placeholderElms.push(placeholderElm)}}],link:function(scope,element,attrs){function isElementInViewport(element){var rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=$window.innerHeight&&rect.right<=$window.innerWidth}function isElementViewed(element){var rect=element.getBoundingClientRect();return rect.left>=0&&rect.right<=$window.innerWidth&&rect.height>=-rect.top&&rect.bottom>=-rect.top&&rect.top<=200}function updatePosition(){if(scope.childElms.length){isElementViewed(element[0]);angular.forEach(scope.childElms,function(child,index){isElementInViewport(scope.getTargetElm(index)[0])?scope.removeChildFixed(index):scope.setChildFixed(index)})}}element.css("position","relative"),$timeout(function(){scope.activeWhen?scope.$watch(function(){return $breakpoint.availUntil(scope.activeWhen)},function(value){value?angular.element($window).bind("scroll",updatePosition):(angular.element($window).unbind("scroll"),angular.forEach(scope.childElms,function(child,index){scope.removeChildFixed(index)}))}):(angular.element($window).bind("scroll",updatePosition),updatePosition())})}}}]).directive("leSticky",[function(){return{restrict:"A",require:"^leStickyContainer",link:function(scope,element,attrs,ctrl){element.addClass("le-sticky"),attrs.hasOwnProperty("fluid")&&element.addClass("sticky-fluid"),attrs.hasOwnProperty("stickyInverted")&&element.addClass("sticky-inverted"),attrs.hasOwnProperty("stickyTop")&&element.addClass("sticky-top"),ctrl.addChild(element)}}}]),angular.module("core").directive("stopEvent",[function(){return{restrict:"A",link:function(scope,element,attrs){element.on(attrs.stopEvent,function(e){e.stopPropagation()})}}}]),angular.module("core").directive("uiselect",["$window",function($window){return{restrict:"EA",templateUrl:"/modules/core/views/uiSelect.client.view.html",scope:{list:"=",selected:"=",selectedProperty:"@?",action:"&?"},link:function(scope,element,attrs){function setDisplayItem(){scope.displayItem=scope.selectedProperty?scope.selected[scope.selectedProperty]:scope.selected}var callbackFn=scope.action();scope.status={isopen:!1},setDisplayItem(),scope.toggleDropdown=function($event){scope.list&&scope.list.length&&($event.preventDefault(),$event.stopPropagation(),scope.status.isopen=!scope.status.isopen)},scope.setChoiceIndex=function(index){scope.selectedProperty?scope.selected[scope.selectedProperty]=scope.list[index]:scope.selected=scope.list[index],setDisplayItem(),scope.status.isopen=!1,callbackFn&&callbackFn(scope.selected)},scope.$watch("list",function(){setDisplayItem()})}}}]),angular.module("core").directive("uiSidebar",["$window","$compile","$timeout","jquery",function($window,$compile,$timeout,$){return{restrict:"E",scope:{onToggle:"=?",onHide:"=?",position:"@?",template:"=?"},link:function(scope,element,attrs){$timeout(function(){element.css("display","none");var sidebarElm=$('<div class="ui simple sidebar push menu"> </div>');sidebarElm.addClass(element.attr("class")),scope.position&&sidebarElm.addClass(scope.position),attrs.hasOwnProperty("verticalMenu")&&sidebarElm.addClass("vertical");var clone=scope.template?scope.template:element.children().clone();$(clone).appendTo(sidebarElm);var targetElm=$compile(sidebarElm)(scope.$parent);$("body").prepend(targetElm),attrs.hasOwnProperty("notClose")&&($(targetElm).sidebar.settings.closable=!1),$(targetElm).sidebar.settings.scrollLock=!0,scope.onToggle=function(){$(targetElm).sidebar("toggle")},scope.onHide=function(){$(targetElm).sidebar("hide")}})}}}]),angular.module("core").filter("capitalize",[function(){return function(input){return input.charAt(0).toUpperCase()+input.slice(1)}}]),angular.module("core").filter("escape",["$window",function($window){return function(input){return input?$window.encodeURIComponent(input):void 0}}]),angular.module("core").filter("translation",["Language",function(Language){return function(input){return input?Language.getText(input):""}}]),angular.module("core").filter("range",function(){return function(input,total){total=parseInt(total);for(var i=0;total>i;i++)input.push(i);return input}}),angular.module("core").filter("seoRoute",["Language",function(Language){return function(input,overwriteId){if(input){var id=overwriteId||input._id,url="";for(var item in input.name)url+=Language.convertTextToEng(input.name[item].toLowerCase());return url.replace(/[^a-zA-Z\d\s]/gi,"").replace(/\s/gi,"-").toLowerCase()+"-"+id}}}]),angular.module("core").filter("timeRemaining",["$filter","Language",function($filter,Language){return function(input){if(input){var days=$filter("amDifference")(input,null,"days");if(1===days)return days+" "+Language.getText("day");if(days>1)return days+" "+Language.getText("days");var hours=$filter("amDifference")(input,null,"hours")+1;return 1===hours?Language.getText("less than")+" "+hours+" "+Language.getText("hour"):hours>1?Language.getText("less than")+" "+hours+" "+Language.getText("hours"):void 0}}}]),angular.module("core").factory("analysis",["$analytics","$window","$filter","Authentication",function($analytics,$window,$filter,Authentication){function signin(){$analytics.eventTrack("signin",{category:"Commands",label:"Signin"})}function signup(){$analytics.eventTrack("signup",{category:"Commands",label:"Signup"})}function addToCart(){flag.addToCart||($analytics.eventTrack("addToCart",{category:"Commands",label:"Add to cart"}),flag.addToCart=!0)}function beginCheckout(items){!flag.beginCheckout&&items.length>0&&($analytics.eventTrack("beginCheckout",{category:"Commands",label:"Begin Checkout"}),flag.beginCheckout=!0)}function transaction(order,productsData){var data={event:"Transaction",transactionId:order.code,transactionTotal:order.paymentSummary.subtotal,transactionShipping:order.paymentSummary.shipping,transactionProducts:[]},products=$filter("filter")(productsData,function(product){var matched=$filter("filter")(order.products,function(item){return(item.product===product.product._id||item.product._id===product.product._id)&&item.variationId===product.variationId});return!!matched});angular.forEach(products,function(product){data.transactionProducts.push({sku:product.product._id,name:product.product.brand.name+" "+product.product.name,price:product.salePrice,quantity:product.quantity})}),dataLayer.push(data)}function checkoutSuccess(order,productsData){$analytics.eventTrack("checkoutSuccess",{category:"Commands",label:"Checkout success"}),transaction(order,productsData),viewTransaction(order,productsData)}function putVariation(variation){_variation=variation?variation:0}function getVariation(){return _variation}function viewProduct(product,variation){var itemId=product._attributeGroupBy?product._id+"_"+variation[product._attributeGroupBy]:product._id;dataLayer.push({event:"criteo",PageType:"Productpage",HashedEmail:Authentication.user.hashedEmail,ProductID:itemId})}function viewHomepage(){dataLayer.push({event:"criteo",PageType:"Homepage",HashedEmail:Authentication.user.hashedEmail})}function viewListingPage(products){var filteredProducts=$filter("filter")(products,function(product){return!product.soldOut}),productsList=[];angular.forEach(filteredProducts.slice(0,3),function(product){var itemId=product.attributeGroupBy?product._id+"_"+product.variation:product._id;productsList.push(itemId)}),dataLayer.push({event:"criteo",PageType:"Listingpage",HashedEmail:Authentication.user.hashedEmail,ProductIDList:productsList})}function viewBasket(items){var productsList=[];angular.forEach(items,function(item){var productId=item.product.type.attributeGroupBy?item.product._id+"_"+item.variation[item.product.type.attributeGroupBy]:item.product._id;productsList.push({id:productId,price:item.quantity,quantity:item.salePrice})}),dataLayer.push({event:"criteo",PageType:"Basketpage",HashedEmail:Authentication.user.hashedEmail,ProductBasketProducts:productsList})}function viewTransaction(order,productsData){var productsList=[];angular.forEach(productsData,function(item){var matchedVariation=$filter("filter")(item.product.variations,function(variation){return variation._id===item.variationId});matchedVariation.length&&(matchedVariation=matchedVariation[0]);var productId=item.product.type.attributeGroupBy?item.product._id+"_"+matchedVariation[item.product.type.attributeGroupBy]:item.product._id;productsList.push({id:productId,price:item.quantity,quantity:item.salePrice})}),dataLayer.push({event:"criteo",PageType:"Transactionpage",HashedEmail:Authentication.user.hashedEmail,ProductTransactionProducts:productsList,TransactionID:order.code})}var dataLayer=$window.dataLayer||[],flag={addToCart:!1,beginCheckout:!1},_variation=null;return{signin:signin,signup:signup,addToCart:addToCart,beginCheckout:beginCheckout,checkoutSuccess:checkoutSuccess,getVariation:getVariation,putVariation:putVariation,viewProduct:viewProduct,viewHomepage:viewHomepage,viewListingPage:viewListingPage,viewBasket:viewBasket}}]).run(["Authentication","analysis","Account",function(Authentication,analysis,Account){Authentication.user&&Authentication.user._id&&Account.get().$promise.then(function(user){user.helper&&user.helper.firstLogin===!0?(analysis.signup(),user.helper.firstLogin=!1,user.$update()):(analysis.signin(),user.helper||(user.helper={firstLogin:!1},user.$update()))}),window.cxApi?analysis.putVariation(window.cxApi.chooseVariation()):analysis.putVariation(1)}]),angular.module("core").factory("$breakpoint",[function(){function getList(){return _list}function setClass(breakpoint){_class=breakpoint["class"]}function getClass(){return _class}function availUntil(className){return SizeEnum[_class]<=SizeEnum[className]}function availFrom(className){return SizeEnum[className]<=SizeEnum[_class]}function getCurrent(){return _class}var _class=null,_list=[{"class":"xs",lowerBound:0},{"class":"sm",lowerBound:768},{"class":"md",lowerBound:991},{"class":"lg",lowerBound:1200}],SizeEnum={xs:1,sm:2,md:3,lg:4};return{getList:getList,setClass:setClass,getClass:getClass,availUntil:availUntil,availFrom:availFrom,getCurrent:getCurrent}}]),angular.module("core").factory("CampaignRest",["$resource",function($resource){return $resource("/api/v1/campaign/:campaignId",{},{search:{isArray:!1,method:"GET",url:"/api/v1/campaign/name/:nameId"}})}]).factory("Campaign",["$window","$q","CampaignRest",function($window,$q,CampaignRest){function searchCampaign(campaignName){var deferred=$q.defer();return CampaignRest.search({nameId:campaignName}).$promise.then(function(campaignData){_campaign=campaignData,deferred.resolve(_campaign)}),deferred.promise}function getCampaign(){return _campaign}function isCampaignState(state){return-1!==_campaignList.indexOf(state.name)}var _campaignList=window.campaign,_campaign=null;return{searchCampaign:searchCampaign,getCampaign:getCampaign,isCampaignState:isCampaignState}}]),angular.module("core").service("jquery",["$window",function($window){return $window.$}]),angular.module("core").constant("charTable",{vn:{a:"a","Äƒ":"a","Ă¢":"a",b:"b",c:"c",d:"d","Ä‘":"d",e:"e","Ăª":"e",g:"g",h:"h",i:"i",k:"k",l:"l",m:"m",n:"n",o:"o","Ă´":"o","Æ¡":"o",p:"p",q:"q",r:"r",s:"s",t:"t",u:"u","Æ°":"u",v:"v",x:"x",y:"y","Ă¡":"a","Ă ":"a","áº£":"a","Ă£":"a","áº¡":"a","áº¯":"a","áº±":"a","áº³":"a","áºµ":"a","áº·":"a","áº¥":"a","áº§":"a","áº©":"a","áº«":"a","áº­":"a","Ă©":"e","Ă¨":"e","áº»":"e","áº½":"e","áº¹":"e","áº¿":"e","á»":"e","á»ƒ":"e","á»…":"e","á»‡":"e","Ă­":"i","Ă¬":"i","á»‰":"i","Ä©":"i","á»‹":"i","Ă³":"o","Ă²":"o","á»":"o","Ăµ":"o","á»":"o","á»‘":"o","á»“":"o","á»•":"o","á»—":"o","á»™":"o","á»›":"o","á»":"o","á»Ÿ":"o","á»¡":"o","á»£":"o","Ăº":"u","Ă¹":"u","á»§":"u","Å©":"u","á»¥":"u","á»©":"u","á»«":"u","á»­":"u","á»¯":"u","á»±":"u","Ă½":"y","á»³":"y","á»·":"y","á»¹":"y","á»µ":"y"}}).factory("Language",["$cookies","Authentication","Account","charTable",function($cookies,Authentication,Account,charTable){function getList(){return list}function setCurrentLanguage(language){currentLanguage=language?$cookies.language&&["vn","en"].indexOf($cookies.language)>-1?$cookies.language:language||DEFAULT_LANGUAGE:$cookies.language||DEFAULT_LANGUAGE}function getLanguage(id){return list[id]?{id:id,language:list[id]}:{id:currentLanguage,language:list[currentLanguage]}}function setDefaultLanguage(id){$cookies.language=id,currentLanguage=id}function getText(text){return"en"===currentLanguage?text:languageTable[currentLanguage][text]?languageTable[currentLanguage][text]:text}function convertTextToEng(text,lang){var selectedLanguage=lang?lang:currentLanguage;return charTable[selectedLanguage]&&charTable[selectedLanguage][text]?charTable[selectedLanguage][text]:text}var currentLanguage,EN="en",VN="vn",languageTable={vn:{day:"ngĂ y",days:"ngĂ y",hour:"giá»",hours:"giá»",Today:"HĂ´m nay",Tomorrow:"NgĂ y mai",Female:"Ná»¯",Male:"Nam","less than":"Ă­t hÆ¡n",Shipping:"PhĂ­ váº­n chuyá»ƒn","Account Credit":"Sá»‘ dÆ° tĂ i khoáº£n",Voucher:"MĂ£ giáº£m giĂ¡","Guaranteed Genuine Products":"Cam káº¿t chĂ­nh hĂ£ng - Giao hĂ ng toĂ n quá»‘c - Thanh toĂ¡n khi nháº­n hĂ ng","Got a question? Call us at 1900 6710":"Báº¡n cáº§n trá»£ giĂºp? HĂ£y gá»i tá»•ng Ä‘Ă i chÄƒm sĂ³c khĂ¡ch hĂ ng 1900-6710","Share the love: refer some friends and get credits!":"Chia sáº» báº¡n bĂ¨, nháº­n ngay 100,000Ä‘ tiá»n thÆ°á»Ÿng!","Sorry, we can't find that username and password combination. Please try again.":"Email hoáº·c máº­t kháº©u cá»§a báº¡n khĂ´ng chĂ­nh xĂ¡c. Xin vui lĂ²ng thá»­ láº¡i.","Your new password entries did not match. Please double check":"Máº­t kháº©u má»›i cá»§a báº¡n khĂ´ng phĂ¹ há»£p. Xin vui lĂ²ng chá»n má»™t máº­t kháº©u khĂ¡c.","Email already exists":"ÄĂ£ tá»“n táº¡i tĂ i khoáº£n vá»›i Ä‘á»‹a chá»‰ email nĂ y. Xin vui lĂ²ng nháº­p máº­t kháº©u Ä‘á»ƒ Ä‘Äƒng nháº­p.","User is already connected using this provider":"Xin vui lĂ²ng Ä‘Äƒng nháº­p báº±ng tĂ i khoáº£n Facebook Ä‘Ă£ dĂ¹ng Ä‘á»ƒ Ä‘Äƒng kĂ½.","Something went wrong. Please try again":"Ráº¥t tiáº¿c! ÄĂ£ xáº£y ra lá»—i trong quĂ¡ trĂ¬nh Ä‘Äƒng kĂ½. Xin vui lĂ²ng táº£i láº¡i trang vĂ  thá»­ láº¡i.","You haven't used this e-mail to sign up yet. Please use it to sign up on our homepage.":"KhĂ´ng tĂ¬m tháº¥y tĂ i khoáº£n nĂ o vá»›i email nĂ y. Xin vui lĂ²ng Ä‘Äƒng kĂ½ trĂªn trang chá»§ cá»§a Leflair nhĂ©!","You have been emailed with password reset instructions":"ÄÆ°á»ng link Ä‘áº·t láº¡i máº­t kháº©u Ä‘Ă£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n. Xin cáº£m Æ¡n.","Already a member":"Email nĂ y Ä‘Ă£ Ä‘Æ°á»£c Ä‘Äƒng kĂ½.","Referred by someone else":"Email nĂ y Ä‘Ă£ Ä‘Æ°á»£c má»i.","You may have a maximum of 5 outstanding invitations":"Báº¡n chá»‰ cĂ³ thá»ƒ má»i tá»‘i Ä‘a 5 ngÆ°á»i","Could not update email":"Thay Ä‘á»•i email khĂ´ng thĂ nh cĂ´ng. Vui lĂ²ng thá»­ láº¡i.","Could not update password":"Thay Ä‘á»•i máº­t kháº©u khĂ´ng thĂ nh cĂ´ng. Máº­t kháº©u cáº§n cĂ³ Ă­t nháº¥t 7 kĂ½ tá»±.","Password changed successfully":"Máº­t kháº©u má»›i Ä‘Ă£ Ä‘Æ°á»£c cáº­p nháº­t","Current password is incorrect":"Máº­t kháº©u hiá»‡n táº¡i khĂ´ng Ä‘Ăºng","Voucher is not valid":"Ráº¥t tiáº¿c. MĂ£ giáº£m giĂ¡ khĂ´ng há»£p lá»‡.","Voucher has already been redeemed":"Ráº¥t tiáº¿c. MĂ£ giáº£m giĂ¡ nĂ y Ä‘Ă£ Ä‘Æ°á»£c sá»­ dá»¥ng.","Voucher has been used or is not valid":"Ráº¥t tiáº¿c. MĂ£ giáº£m giĂ¡ khĂ´ng há»£p lá»‡.","You can only use one voucher for this order":"Báº¡n chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng tá»‘i Ä‘a 1 mĂ£ giáº£m giĂ¡ cho Ä‘Æ¡n hĂ ng nĂ y.","Gift Card is not valid":"Ráº¥t tiáº¿c. MĂ£ quĂ  táº·ng khĂ´ng há»£p lá»‡.","Gift Card has already been redeemed":"Ráº¥t tiáº¿c. MĂ£ quĂ  táº·ng nĂ y Ä‘Ă£ Ä‘Æ°á»£c sá»­ dá»¥ng.","Unable to process gift card. Please contact support.":"CĂ³ lá»—i xáº£y ra khi náº¡p tháº» quĂ  táº·ng. Vui lĂ²ng liĂªn há»‡ CSKH Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£ thĂªm.","Error adding item to cart.":"ÄĂ£ xáº£y ra lá»—i khi thĂªm hĂ ng vĂ o giá». Xin vui lĂ²ng thá»­ láº¡i.","Maximum of 10 items allowed":"Má»—i giá» hĂ ng chá»‰ Ä‘Æ°á»£c cĂ³ tá»‘i Ä‘a 10 sáº£n pháº©m.","Error removing item":"ÄĂ£ cĂ³ lá»—i khi báº¡n bá» sáº£n pháº©m khá»i giá». Xin vui lĂ²ng thá»­ láº¡i.","Error updating item":"ÄĂ£ xáº£y ra lá»—i khi cáº­p nháº­t sáº£n pháº©m. Xin vui lĂ²ng thá»­ láº¡i.","Please verify your birthday again":"Xin vui lĂ²ng kiá»ƒm tra ngĂ y sinh cá»§a báº¡n","Your tax code is invalid":"MĂ£ sá»‘ thuáº¿ khĂ´ng há»£p lá»‡","Please select a credit card":"Vui lĂ²ng chá»n má»™t tháº» tĂ­n dá»¥ng","Please verify your shipping address":"Vui lĂ²ng kiá»ƒm tra Ä‘á»‹a chá»‰ váº­n chuyá»ƒn cá»§a báº¡n","Please verify your billing address":"Vui lĂ²ng kiá»ƒm tra Ä‘á»‹a chá»‰ thanh toĂ¡n cá»§a báº¡n","Please enter CVV number":"Vui lĂ²ng nháº­p mĂ£ CVV","We don't support this type of credit card":"Ráº¥t tiáº¿c. ChĂºng tĂ´i khĂ´ng há»— trá»£ loáº¡i tháº» tĂ­n dá»¥ng nĂ y.","Please verify your new credit card again":"Vui lĂ²ng kiá»ƒm tra tháº» tĂ­n dá»¥ng má»›i cá»§a báº¡n má»™t láº§n ná»¯a","You have already entered this card. Please select it from the list above":"Báº¡n Ä‘Ă£ nháº­p tháº» nĂ y. Vui lĂ²ng chá»n tháº» tá»« danh sĂ¡ch bĂªn trĂªn.","This transaction has been declined by your bank":"Tháº­t Ä‘Ă¡ng tiáº¿c nhÆ°ng ngĂ¢n hĂ ng Ä‘Ă£ tá»« chá»‘i phÆ°Æ¡ng thá»©c thanh toĂ¡n cá»§a báº¡n. HĂ£y liĂªn láº¡c láº¡i vá»›i nhĂ  cung cáº¥p hoáº·c thay Ä‘á»“i má»™t phÆ°Æ¡ng thá»©c khĂ¡c.","This card has been lost/stolen":"Ráº¥t tiáº¿c. NgĂ¢n hĂ ng cá»§a báº¡n Ä‘Ă£ tá»« chá»‘i giao dá»‹ch nĂ y.","Invalid cardholder name":"TĂªn chá»§ tháº» khĂ´ng há»£p lá»‡. Xin vui lĂ²ng thá»­ láº¡i.","Same card used more than 6 times a day":"Ráº¥t tiáº¿c. Tháº» nĂ y Ä‘Ă£ Ä‘Æ°á»£c sá»­ dá»¥ng hÆ¡n 6 láº§n/ ngĂ y.","We cannot verify this card":"Ráº¥t tiáº¿c. ChĂºng tĂ´i khĂ´ng thá»ƒ xĂ¡c minh tháº» nĂ y.","This card has already been registered":"Báº¡n Ä‘Ă£ nháº­p tháº» nĂ y. Vui lĂ²ng chá»n tháº» tá»« danh sĂ¡ch bĂªn trĂªn.","Invalid card number":"Sá»‘ tháº» nĂ y khĂ´ng há»£p lá»‡. Xin vui lĂ²ng thá»­ láº¡i.","Issuing bank not match":"ThĂ´ng tin ngĂ¢n hĂ ng khĂ´ng chĂ­nh xĂ¡c","We cannot complete this transaction. Please check all your information again":"ChĂºng tĂ´i khĂ´ng thá»ƒ hoĂ n táº¥t giao dá»‹ch nĂ y . Vui lĂ²ng kiá»ƒm tra táº¥t cáº£ cĂ¡c thĂ´ng tin cá»§a báº¡n má»™t láº§n ná»¯a","You did not pass the 3D Secure Authentication to confirm your identity. Please contact your card issuing bank for more details about 3D Secure Authentication.":"XĂ¡c thá»±c 3D Secure Authentication khĂ´ng thĂ nh cĂ´ng. HĂ£y liĂªn láº¡c láº¡i vá»›i nhĂ  cung cáº¥p hoáº·c thay Ä‘á»“i má»™t phÆ°Æ¡ng thá»©c khĂ¡c.","Your card issuer has disapproved this transactions. Reasons behind includes marginally credit record, abnormal purchase amount or frequency, credit card not allowed for online payment, etc. Please contact your card issuing bank for the account status.":"NgĂ¢n hĂ ng cá»§a báº¡n Ä‘Ă£ tá»« chá»‘i giao dá»‹ch nĂ y. Vui lĂ²ng liĂªn há»‡ vá»›i ngĂ¢n hĂ ng cá»§a báº¡n Ä‘á»ƒ biáº¿t thĂªm chi tiáº¿t.","The credit limit of the card is not enough to process this transaction.":"Háº¡n má»©c tĂ­n dá»¥ng cá»§a tháº» nĂ y khĂ´ng Ä‘á»§ Ä‘á»ƒ xá»­ lĂ½ giao dá»‹ch nĂ y. Vui lĂ²ng liĂªn há»‡ vá»›i ngĂ¢n hĂ ng cá»§a báº¡n Ä‘á»ƒ biáº¿t thĂªm chi tiáº¿t.","An error occured: items do not match":"Giao dá»‹ch khĂ´ng thĂ nh cĂ´ng. Vui lĂ²ng thá»­ láº¡i.","An error occured: Cannot validate sale of item":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","An error occured: sale of item is not running":"Má»™t trong nhá»¯ng Æ°u Ä‘Ă£i trong giá» hĂ ng Ä‘Ă£ káº¿t thĂºc. Giá» hĂ ng cá»§a báº¡n Ä‘Ă£ Ä‘Æ°á»£c cáº­p nháº­t.","An error occured: item prices do not match those in cart":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","An error occured: item quantities do not match those in cart":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","An error occured: an item has been removed from your bag":"Má»™t trong nhá»¯ng sáº£n pháº©m trong giá» hĂ ng cĂ³ lá»—i. Giá» hĂ ng cá»§a báº¡n Ä‘Ă£ Ä‘Æ°á»£c cáº­p nháº­t.","One of your items is out of stock and has been removed from your cart:":"Má»™t trong nhá»¯ng sáº£n pháº©m trong giá» hĂ ng Ä‘Ă£ háº¿t hĂ ng. Giá» hĂ ng cá»§a báº¡n Ä‘Ă£ Ä‘Æ°á»£c cáº­p nháº­t.","An error occured: cannot find product variation":"Má»™t Æ°u Ä‘Ă£i trong giá» hĂ ng cá»§a báº¡n Ä‘Ă£ káº¿t thĂºc. Giá» hĂ ng Ä‘Ă£ Ä‘Æ°á»£c cáº­p nháº­t thĂ nh cĂ´ng.","One of your items has low quantity and has been updated in your cart":"Má»™t sáº£n pháº©m trong giá» cĂ³ sá»‘ lÆ°á»£ng cao hÆ¡n má»©c hiá»‡n cĂ³. Giá» hĂ ng cá»§a báº¡n Ä‘Ă£ Ä‘Æ°á»£c cáº­p nháº­t.","An error has occured: shipping price invalid":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","An error has occured: account credit error":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","An error has occured: order total does not match":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","An error has occured: could not validate your credit card":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","Cannot generate order":"CĂ³ lá»—i há»‡ thá»‘ng. Vui lĂ²ng thá»­ láº¡i","Maximum quantity for this product already reached":"Báº¡n Ä‘Ă£ chá»n sá»‘ lÆ°á»£ng sáº£n pháº©m tá»‘i Ä‘a cho phĂ©p"}},list={en:{name:"English",shortName:"ENG"},vn:{name:"Tiáº¿ng Viá»‡t",shortName:"VN"}},DEFAULT_LANGUAGE="vn";return{EN:EN,VN:VN,getList:getList,getLanguage:getLanguage,setCurrentLanguage:setCurrentLanguage,setDefaultLanguage:setDefaultLanguage,getText:getText,convertTextToEng:convertTextToEng}}]).run(["Language","Account","Authentication",function(Language,Account,Authentication){return Authentication.user?Account.get().$promise.then(function(user){Language.setCurrentLanguage(user.language)}):void Language.setCurrentLanguage()}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("core").constant("month",[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]),angular.module("core").constant("regex",{password:/^.{7}/,giftcard:/^.{7}$/,taxCode:/^.{10}(-.{3})?$/,phone:/^[0-9]{8,11}$/,day:/^\d{1,2}$/,year:/^(\d{2}|\d{4})$/,cardNumber:/^\d{15,16}$/,cvv:/^\d{3,4}$/}),angular.module("pages").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("about",{url:"/pages/about",templateUrl:"/modules/pages/views/about.client.view.html"}).state("partners",{url:"/pages/partners",templateUrl:"/modules/pages/views/partners.client.view.html"}).state("careers",{url:"/pages/careers",templateUrl:"/modules/pages/views/careers.client.view.html"})}]),angular.module("product").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("product",{url:"/products/:product",templateUrl:"/modules/products/views/product.client.view.html",controller:"ProductController",resolve:{productId:["$stateParams",function($stateParams){return $stateParams.product.split("-").pop()}],product:["Products","productId","$location",function(Products,productId,$location){return Products.get({productId:productId}).$promise.then(function(data){return data},function(err){$location.path("/")})}],recommendations:["Products","productId",function(Products,productId){return Products.recommendations({productId:productId}).$promise}]}})}]),angular.module("product").controller("ProductController",["$scope","$templateCache","Cart","product","recommendations","analysis","$modal","Products","$stateParams","$filter","$timeout","$location",function($scope,$templateCache,Cart,product,recommendations,analysis,$modal,Products,$stateParams,$filter,$timeout,$location){function setQueryParams(variation){angular.forEach($scope.attributesList,function(key){$location.search(key,variation[key]).replace()})}function getQueryParams(){var params=$location.search();if(params.v){if($scope.product._attributeGroupBy){var variation=params.v;return $location.search("v",null),$location.search($scope.product._attributeGroupBy,variation).replace(),variation}}else if($scope.product._attributeGroupBy)return params[$scope.product._attributeGroupBy];return null}function getInvalidAttribute(variation){var result=$filter("filter")(Object.keys(variation),function(key){return null===variation[key]});return result[0]}function getVariationId(product,currentVariations){var keys=Object.keys(currentVariations);if(0===keys.length)return product.variations[0]._id;var matched=$filter("filter")(product.variations,currentVariations,!0);return matched[0]._id}$scope.recommendations=recommendations,$scope.addToCartQuantity=1,$scope.product=product,$scope.product.variationAttributes&&($scope.attributesList=Object.keys($scope.product.variationAttributes)),$scope.accordionList=[],$scope.accordionList[0]=!0,$scope.currentVariations={},$scope.imageIndex=0,$scope.calculateQuantity=function(){$scope.product.$promise.then(function(){if($scope.isSelectionValid()){var variation=$filter("filter")($scope.product.variations,$scope.currentVariations,!0)[0];$scope.availableQuantity=variation?variation._quantity:0}})},$scope.getTotalQuantityOfSelectedVariation=function(value){var total=0,group=$scope.product._attributeGroupBy;return angular.forEach($scope.product.variations,function(variation){variation[group]!==value&&null!==group||(total+=variation._quantity)}),total},$scope.getSalePrice=function(){if($scope.product){var filterObj=angular.copy($scope.currentVariations);angular.forEach($scope.currentVariations,function(val,key){null===val&&delete filterObj[key]});var matches=$filter("filter")($scope.product.variations,filterObj);return matches&&0!==matches.length&&matches[0]._salePrice?matches[0]._salePrice:$scope.product.salePrice}},$scope.getRetailPrice=function(){if($scope.product){var filterObj=angular.copy($scope.currentVariations);angular.forEach($scope.currentVariations,function(val,key){null===val&&delete filterObj[key]});var matches=$filter("filter")($scope.product.variations,filterObj);return matches&&0!==matches.length&&matches[0]._retailPrice?matches[0]._retailPrice:$scope.product.retailPrice}},$scope.setImageIndex=function(index){$scope.imageIndex=index},$scope.setSelectedVariation=function(){if(!($scope.selectedVariation||angular.isUndefined($scope.product)||angular.isUndefined($scope.product._attributeGroupBy)||angular.isUndefined($scope.product.variations)))if(null===$scope.product._attributeGroupBy)$scope.selectedVariation="All";else{for(var attributeGroupBy=$scope.product._attributeGroupBy,variant=null,index=0;index<$scope.product.variationAttributes[attributeGroupBy].length;++index){var item=$scope.product.variationAttributes[$scope.product._attributeGroupBy][index];variant=angular.isString(item)?item:item.name;for(var totalQuantities=0,j=0;j<$scope.product.variations.length;++j){var variation=$scope.product.variations[j];variation[attributeGroupBy]===variant&&(totalQuantities+=variation._quantity)}if(totalQuantities>0)break}$scope.selectedVariation=variant;var variationObj={};variationObj[attributeGroupBy]=variant,setQueryParams(variationObj)}},$scope.setAttributeTypes=function(){angular.forEach($scope.product.variationAttributes,function(attributes){attributes.attrType=angular.isString(attributes[0])?"standard":"color"})},$scope.bootstrapCurrentVariations=function(){var attributes=$scope.product.variationAttributes?Object.keys($scope.product.variationAttributes):[];if(0!==attributes.length){if(null!==$scope.product._attributeGroupBy)$scope.currentVariations[$scope.product._attributeGroupBy]=$scope.selectedVariation;else{var item=$scope.product.variationAttributes[attributes[0]][0];$scope.currentVariations[attributes[0]]=angular.isString(item)?item:item.name}2===attributes.length&&(angular.isUndefined($scope.currentVariations[attributes[0]])&&(angular.isDefined($location.search()[attributes[0]])?$scope.currentVariations[attributes[0]]=$location.search()[attributes[0]]:1===$scope.product.variationAttributes[attributes[0]].length?$scope.currentVariations[attributes[0]]=angular.isDefined($scope.product.variationAttributes[attributes[0]][0].name)?$scope.product.variationAttributes[attributes[0]][0].name:$scope.product.variationAttributes[attributes[0]][0]:$scope.currentVariations[attributes[0]]=null),angular.isUndefined($scope.currentVariations[attributes[1]])&&(angular.isDefined($location.search()[attributes[1]])?$scope.currentVariations[attributes[1]]=$location.search()[attributes[1]]:1===$scope.product.variationAttributes[attributes[1]].length?$scope.currentVariations[attributes[1]]=angular.isDefined($scope.product.variationAttributes[attributes[1]][0].name)?$scope.product.variationAttributes[attributes[1]][0].name:$scope.product.variationAttributes[attributes[1]][0]:$scope.currentVariations[attributes[1]]=null))}},$scope.createVariationWatcher=function(){null!==$scope.product._attributeGroupBy&&$scope.$watch("currentVariations",function(newValue,oldValue){newValue!==oldValue&&($scope.selectedVariation=$scope.currentVariations[$scope.product._attributeGroupBy],setQueryParams(newValue))},!0)},$scope.isSelectionValid=function(){return Object.keys($scope.currentVariations).every(function(key){return null!==$scope.currentVariations[key]})},$scope.addToCart=function(){if($scope.failedSubmit=!1,!$scope.isSelectionValid())return $scope.failedSubmit=!0,void($scope.missingAttribute=getInvalidAttribute($scope.currentVariations));analysis.addToCart();var itemToAdd={product:$scope.product._id,variation:$scope.currentVariations,variationId:getVariationId($scope.product,$scope.currentVariations),quantity:+$scope.addToCartQuantity,returns:$scope.product._isReturnable};Cart.addItem(itemToAdd,function(item){Cart.toggle()},function(errorResponse){Cart.toggle(errorResponse),$scope.error="Error adding item to cart.";
})},$scope.showSizeChart=function(){$scope.sizeTable=$scope.product.sizeTable,$scope.chartModalInstance=$modal.open({templateUrl:"/modules/products/views/size-chart.client.view.html",scope:$scope,size:"lg",windowClass:"size-chart-modal",animation:!1})},$scope.getSizeAttr=function(value,name){var matchedValues=$filter("filter")($scope.product.sizeTable.sizeChart,function(size){return size.name===name});return matchedValues=matchedValues[0],matchedValues.values[$scope.product.sizeTable.values.indexOf(value)]},$scope.selectActiveRow=function(value){return $scope.currentVariations&&$scope.currentVariations.Size&&$scope.currentVariations.Size===value},$scope.selectedVariation=getQueryParams(),$scope.setSelectedVariation(),$scope.bootstrapCurrentVariations(),analysis.viewProduct(product,$scope.currentVariations),$scope.setAttributeTypes(),$scope.missingAttribute=$scope.isSelectionValid()?null:getInvalidAttribute($scope.currentVariations),$scope.createVariationWatcher(),$scope.calculateQuantity(),$scope.product.sizeTable&&($scope.sizeTitle=[],angular.forEach($scope.product.sizeTable.sizeChart,function(size){$scope.sizeTitle.push(size.name)}),$scope.availSizes=[],angular.forEach($scope.product.variations,function(variation){$scope.availSizes.indexOf(variation.Size)<0&&$scope.availSizes.push(variation.Size)}),$scope.availSizes=$filter("orderBy")($scope.availSizes)),$scope.$watch("currentVariations",function(){$scope.failedSubmit=!1,$scope.calculateQuantity(),$scope.addToCartQuantity=1,$scope.doneAddToWishlist=!1},!0),$scope.addToWishlist=function(){return $scope.doneAddToWishlist?void 0:$scope.isSelectionValid($scope.currentVariations)?void Products.addWishItem({productId:$scope.product._id},$scope.currentVariations).$promise.then(function(item){$scope.doneAddToWishlist=!0,$scope.failedSubmit=!1,$scope.missingAttribute=null;var matched=$filter("filter")($scope.product.wishlist,function(variation){return angular.equals(variation.variation,$scope.currentVariations)});matched.length&&(matched[0].wishlistExisted=!0)}):($scope.failedSubmit=!0,void($scope.missingAttribute=getInvalidAttribute($scope.currentVariations)))},$scope.isItemAlreadyInWishlist=function(currentVariation){var variation=angular.isObject(currentVariation)&&currentVariation!=={}?angular.copy(currentVariation):null,matches=$filter("filter")($scope.product.wishlist,function(item){return angular.equals(item.variation,variation)});return matches&&matches.length?matches[0].wishlistExisted:!1},$scope.$on("$destroy",function(){$scope.chartModalInstance&&$scope.chartModalInstance.close()})}]),angular.module("product").directive("accordionScroll",["$document","$timeout","$filter","$breakpoint","jquery",function($document,$timeout,$filter,$breakpoint,$){return{restrict:"A",scope:{accordionScroll:"="},link:function(scope,element,attrs){var OFFSET=50,DELAYED_TIME=350,_isFirstTime=!0;$timeout(function(){scope.$watchCollection("accordionScroll",function(){var panelElms=$(element).find(".panel"),matched=[];angular.forEach(panelElms,function(item,index){scope.accordionScroll[index]===!0&&matched.push(item)}),matched.length&&(_isFirstTime?_isFirstTime=!1:$breakpoint.availUntil("xs")&&$timeout(function(){$document.scrollToElementAnimated(matched[0],parseInt(OFFSET))},DELAYED_TIME))})})}}}]),angular.module("product").directive("descriptionDisplay",["$timeout",function($timeout){return{templateUrl:"/modules/products/views/description-display.client.view.html",restrict:"E",scope:{contents:"="},link:function(scope,element,attrs){function isNotEmpty(item){return""!==item}var TARGET_CHARACTER="~";$timeout(function(){scope.contents.indexOf(TARGET_CHARACTER)>-1?scope.formattedContents=scope.contents.split(TARGET_CHARACTER).filter(isNotEmpty).reduce(function(result,item){var list=item.split(/\n/g).filter(isNotEmpty);return list.length>1?result.push({header:list.shift(),data:list}):result.push(list[0]),result},[]):scope.formattedContents=scope.contents.split(/\n/g)})}}}]),angular.module("product").directive("productAttrState",["$document","$timeout","jquery",function($document,$timeout,$){return{restrict:"C",link:function(scope,element,attrs){$timeout(function(){var nWidth=$(element).innerWidth(),nHeight=$(element).innerHeight(),nDiagonal=Math.sqrt(nWidth*nWidth+nHeight*nHeight),nAnglRad=Math.atan2(nHeight,nWidth),nAnglSex=360*nAnglRad/(2*Math.PI),nDiagonal2=nDiagonal/2,nCatOp=Math.sin(nAnglRad)*nDiagonal2,nCatAd=Math.sqrt(nDiagonal2*nDiagonal2-nCatOp*nCatOp),leftLineDom='<b class="left line" style="';leftLineDom+="width: "+nDiagonal+"px;",leftLineDom+="-webkit-transform: rotate(-"+nAnglSex+"deg) scale(0.9);",leftLineDom+="-moz-transform: rotate(-"+nAnglSex+"deg) scale(0.9);",leftLineDom+="-ms-transform: rotate(-"+nAnglSex+"deg) scale(0.9);",leftLineDom+="-o-transform: rotate(-"+nAnglSex+"deg) scale(0.9);",leftLineDom+="transform: rotate(-"+nAnglSex+"deg) scale(0.9);",leftLineDom+="margin-top: -"+nCatOp+"px;",leftLineDom+="margin-left: -"+(nDiagonal2-nCatAd)+"px;",leftLineDom+='"></b>',$(element).append($(leftLineDom));var rightLineDom='<b class="right line" style="';rightLineDom+="width: "+nDiagonal+"px;",rightLineDom+="-webkit-transform: rotate("+nAnglSex+"deg) scale(0.9);",rightLineDom+="-moz-transform: rotate("+nAnglSex+"deg) scale(0.9);",rightLineDom+="-ms-transform: rotate("+nAnglSex+"deg) scale(0.9);",rightLineDom+="-o-transform: rotate("+nAnglSex+"deg) scale(0.9);",rightLineDom+="transform: rotate("+nAnglSex+"deg) scale(0.9);",rightLineDom+="margin-top: -"+nCatOp+"px;",rightLineDom+="margin-left: -"+(nDiagonal2-nCatAd)+"px;",rightLineDom+='"></b>',$(element).append($(rightLineDom))})}}}]),angular.module("product").directive("productAttributeWidth",["$timeout","jquery",function($timeout,$){return{restrict:"A",link:function(scope,element,attrs){function getMaxWidth(list){var max=0;return angular.forEach(list,function(item){max=item.clientWidth>max?item.clientWidth:max}),max}function applyWidth(list,width){angular.forEach(list,function(item){$(item).css("width",width+"px")})}$timeout(function(){var btnList=element.find("button"),maxWidth=getMaxWidth(btnList);applyWidth(btnList,maxWidth)})}}}]),angular.module("product").directive("productAttribute",["$filter","$breakpoint","$document",function($filter,$breakpoint,$document){return{template:'<div ng-include="getTemplateUrl()"></div>',restrict:"E",scope:{name:"=",values:"=",product:"=",state:"=",missingAttribute:"=?",onAddCart:"&?",onAddWishlist:"&?",trigger:"=?"},link:function(scope,element,attrs){function hexToRGBA(hex,enabled){return[parseInt(hex.slice(1,3),16),parseInt(hex.slice(3,5),16),parseInt(hex.slice(5,7),16),1]}scope.getTemplateUrl=function(){return"/modules/products/views/product-attribute-"+scope.values.attrType+".client.view.html"},scope.$breakpoint=$breakpoint;var OFFSET=400;if(scope.notHidden=function(value){return value.hidden!==!0},scope.isTotalEmpty=function(value){var filterObj={};filterObj[scope.name]=value;var matchingVariations=$filter("filter")(scope.product.variations,filterObj,!0),result=0;return angular.forEach(matchingVariations,function(variation){result+=variation._quantity}),!result},scope.isActive=function(value){return scope.state[scope.name]===value},scope.getActiveList=function(){var filterObj=angular.copy(scope.state);delete filterObj[scope.missingAttribute];var matchingVariations=$filter("filter")(scope.product.variations,filterObj);return $filter("filter")(matchingVariations,function(matchingVariation){return matchingVariation._quantity>0})},scope.isMissingAttributeActive=function(value){var matched=$filter("filter")(scope.getActiveList(),function(item){return item[scope.missingAttribute]===value});return matched.length>0},scope.addVariation=function(value){scope.isMissingAttributeActive(value)&&(scope.state[scope.missingAttribute]=value,scope.onAddCart(scope.state))},scope.setActive=function(value){scope.state[scope.name]=value,scope.trigger&&scope.onAddWishlist()(scope.state)},scope.$watch("trigger",function(){scope.trigger&&$document.scrollToElementAnimated(element,parseInt(OFFSET))}),scope.validSelections=[],scope.selectable=scope.returnTrue=function(){return!0},scope.realSelectable=function(value){return scope.validSelections.indexOf(value)>-1},2===Object.keys(scope.state).length){var keys=Object.keys(scope.state);keys.splice(keys.indexOf(scope.name),1);var otherKey=keys[0],filterObj={};filterObj[otherKey]=null,scope.tooltip="Not available in selected "+otherKey,scope.$watch("state."+otherKey,function(newValue,oldValue){if(null===newValue)return void(scope.selectable=scope.returnTrue);scope.selectable=scope.realSelectable,filterObj[otherKey]=newValue;var matchingVariations=$filter("filter")(scope.product.variations,filterObj);matchingVariations=$filter("filter")(matchingVariations,function(matchingVariation){return matchingVariation._quantity>0}),scope.validSelections=matchingVariations.map(function(variation){return variation[scope.name]})})}scope.getBorderColor=function(value){if(value){var borderRGBA=hexToRGBA(value.hex);return"rgba("+borderRGBA.join(",")+")"}},scope.getBorderRightColor=function(value){if(value){var hex=value.hex2||value.hex,borderRGBA=hexToRGBA(hex);return"rgba("+borderRGBA.join(",")+")"}},scope.getBorderBottomColor=function(value){if(value){var hex=!value.hex2minor&&value.hex2?value.hex2:value.hex,borderRGBA=hexToRGBA(hex);return"rgba("+borderRGBA.join(",")+")"}},scope.getSizeValue=function(value){return scope.product.sizeTable.values.indexOf(value)}}}}]),angular.module("product").directive("productVerticalSlide",["$timeout","$interval","jquery",function($timeout,$interval,$){return{templateUrl:"/modules/products/views/product-vertical-slide.client.view.html",restrict:"E",scope:{slides:"=",setImageIndex:"&"},link:function(scope,element,attrs){function getStepLength(imgHeight){return imgHeight*NUM_IMG/NUM_STEP}function getScrollLength(scrollTop,imgHeight){return scrollTop+imgHeight*NUM_IMG}var NUM_IMG=3,NUM_STEP=10,DELAYED_TIME=20;$timeout(function(){scope.arrowElms=$(element).find(".arrow-box"),scope.contentElm=$(element).find(".content"),scope.imgList=$(scope.contentElm).find("img"),scope.$watch("slides",function(){scope.slides&&scope.isActive(scope.slides)&&(scope.contentHeight=$(element).parent()[0].clientHeight-2*scope.arrowElms[0].clientHeight)}),scope.contentElm.bind("mousewheel",function(event){event.preventDefault()})}),scope.moveDown=function(){if(!angular.isDefined(scope.animating)){var imgHeight=scope.imgList[0].clientHeight,step=getStepLength(imgHeight),maxScroll=scope.contentElm[0].scrollHeight-scope.contentElm[0].clientHeight,scrollLength=getScrollLength(scope.contentElm[0].scrollTop,imgHeight);scrollLength=scrollLength>maxScroll?maxScroll:scrollLength,scope.animating=$interval(function(){var length=scope.contentElm[0].scrollTop+step;length+scope.contentElm[0].clientHeight>=scope.contentElm[0].scrollHeight||length>=scrollLength?(scope.contentElm[0].scrollTop=scrollLength,$interval.cancel(scope.animating),scope.animating=void 0):scope.contentElm[0].scrollTop=length},DELAYED_TIME)}},scope.reset=function(){scope.animating=void 0},scope.moveUp=function(){if(!angular.isDefined(scope.animating)){var imgHeight=scope.imgList[0].clientHeight,step=getStepLength(imgHeight),scrollLength=getScrollLength(scope.contentElm[0].scrollTop,-imgHeight);scrollLength=scrollLength>0?scrollLength:0,scope.animating=$interval(function(){var length=scope.contentElm[0].scrollTop-step;scrollLength>length?(scope.contentElm[0].scrollTop=scrollLength,$interval.cancel(scope.animating),scope.animating=void 0):scope.contentElm[0].scrollTop=length},DELAYED_TIME)}},scope.imageIndex=scope.setImageIndex(),scope.isActive=function(slides){return slides&&slides.length>6}}}}]),angular.module("product").directive("productSlide",["$breakpoint","$modal","$document","$timeout","jquery",function($breakpoint,$modal,$document,$timeout,$){return{templateUrl:"/modules/products/views/productSlide.client.view.html",restrict:"E",scope:{images:"="},link:function(scope,element,attrs){scope.interval=0;var modalInstance=($document.find("body"),null);scope.$watch(function(){return $breakpoint.availUntil("xs")},function(value){scope.interval=value?5e3:0}),scope.$watch("images",function(){if(scope.images){scope.slides=[];for(var index in scope.images)scope.slides.push({url:scope.images[index]});scope.slides[0].active=!0}}),scope.setImageIndex=function(index){for(var i in scope.slides)parseInt(i)!==parseInt(index)?scope.slides[i].active=!1:scope.slides[i].active=!0},scope.onTap=function(event,slide){var bb=event.target.getBoundingClientRect(),position={x:event.center.x-bb.left,y:event.center.y-bb.top},percentage={x:position.x/element[0].clientWidth,y:position.y/element[0].clientHeight};modalInstance=$modal.open({controller:function($scope,$modalInstance,$window){$scope.image=slide;var OFFSET_MODAL=30;$scope.windowHeight=$window.innerHeight+OFFSET_MODAL;var elm=null;$timeout(function(){elm=$("#zoomImg").parent()[0],elm.scrollLeft+=elm.scrollWidth*percentage.x-elm.clientWidth/2,elm.scrollTop+=elm.scrollHeight*percentage.y-elm.clientHeight/2}),$scope.close=function(){$modalInstance.close()},$scope.previousCenter={},$scope.start=function(event){$scope.previousCenter=event.center},$scope.move=function(event){elm.scrollLeft+=$scope.previousCenter.x-event.center.x,elm.scrollTop+=$scope.previousCenter.y-event.center.y,$scope.previousCenter=event.center}},templateUrl:"/modules/products/views/productCarousel.client.view.html",size:"lg",backdropClass:"product-slide-bd",animation:!1,windowClass:"product-slide img-zooming"})},scope.$on("$destroy",function(){modalInstance&&modalInstance.close()})}}}]).directive("imgZooming",["$timeout","jquery",function($timeout,$){return{restrict:"E",scope:{url:"=",trigger:"@?"},link:function(scope,elm,attr){elm.css("display","block"),$timeout(function(){elm.css("display","block"),$(elm).zoom({url:scope.url,magnify:1,on:scope.trigger||"mouseover"})})}}}]),angular.module("product").factory("Products",["$resource",function($resource){return $resource("/api/v1/products/:productId",{},{recommendations:{isArray:!0,method:"GET",url:"/api/v1/products/:productId/recommendations"},addWishItem:{method:"POST",url:"/api/v1/products/:productId/wishlist"},recommendationsFromOrder:{isArray:!0,method:"GET",url:"/api/v1/products/recommendations/:orderCode"}})}]),angular.module("sale").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("sale",{url:"/sales/:sale",templateUrl:"/modules/sales/views/sale.client.view.html",controller:"SaleController",resolve:{sale:["$stateParams","Sales","$location",function($stateParams,Sales,$location){var saleId=$stateParams.sale.split("-").pop();return Sales.get({saleId:saleId}).$promise.then(function(sale){return sale},function(err){$location.path("/")})}]}}).state("upcomingSale",{url:"/sales/upcoming/:sale",templateUrl:"/modules/sales/views/upcoming-sale.client.view.html"}).state("sale-list",{url:"/",templateUrl:"/modules/sales/views/sales-list.client.view.html",controller:"SalesListController",resolve:{bestSeller:["Sales",function(Sales){return Sales.bestSeller().$promise}],sales:["Sales",function(Sales){return Sales.query().$promise}],account:["Account","Authentication",function(Account,Authentication){return Authentication.user?Account.get().$promise:null}]}})}]),angular.module("sale").controller("SaleController",["$scope","Sales","sale","analysis",function($scope,Sales,sale,analysis){$scope.sale=sale,$scope.productFilter={brands:!1,types:!1},$scope.sale.$promise.then(function(){var arr=[];analysis.viewListingPage($scope.sale.products);var brands=$scope.sale.products.reduce(function(brands,product){return-1===arr.indexOf(product.brand)&&(arr.push(product.brand),brands.push({name:product.brand,selected:!1})),brands},[]);$scope.productFilter.brands=brands.length>1?brands:!1,arr=[];var types=$scope.sale.products.reduce(function(types,product){return-1===arr.indexOf(product.type.displayName)&&(arr.push(product.type.displayName),types.push({name:product.type.displayName,selected:!1})),types},[]);$scope.productFilter.types=types.length>1?types:!1}),$scope.clearFilters=function(){angular.forEach($scope.productFilter.brands,function(brand){brand.selected=!1}),angular.forEach($scope.productFilter.types,function(type){type.selected=!1})}}]),angular.module("sale").controller("SalesListController",["$scope","sales","$filter","$breakpoint","bestSeller","analysis","account",function($scope,sales,$filter,$breakpoint,bestSeller,analysis,account){$scope.$breakpoint=$breakpoint,$scope.sales=sales,analysis.viewHomepage(),$scope.upcomingList=[],angular.forEach(sales.upcoming,function(sale){sale.campaign?account.campaigns.indexOf(sale.campaignId)>-1&&$scope.upcomingList.push(sale):$scope.upcomingList.push(sale)}),$scope.bestSeller=bestSeller,$scope.getSaleLink=function(sale){return sale?sale.POTD?"/products/"+$filter("seoRoute")(sale,sale.POTDId):"/sales/"+$filter("seoRoute")(sale):void 0}}]),angular.module("sale").controller("UpcomingSaleController",["$scope","Sales","$stateParams",function($scope,Sales,$stateParams){$scope.saleId=$stateParams.sale.split("-").pop(),$scope.sale=Sales.upcoming({saleId:$scope.saleId})}]),angular.module("sale").directive("bestSeller",["$breakpoint","$window","$timeout","$interval",function($breakpoint,$window,$timeout,$interval){return{templateUrl:"/modules/sales/views/bestSeller.client.view.html",restrict:"E",scope:{products:"="},link:function(scope,element,attrs){function getNumberDisplay(){switch($breakpoint.getCurrent()){case"lg":return 4;case"md":return 4;case"sm":return 2;case"xs":return 1}}function getImgSize(){var containerWidth=outerBoxElm[0].clientWidth;return containerWidth/getNumberDisplay()}function setImgSize(item,size){angular.element(item).css("width",size+"px")}function getInnerBoxElmSize(itemList,imgSize){return itemList.length*imgSize}function setInnerBoxElmSize(size){innerBoxElm.css("width",size+"px")}function calculate(){var imgSize=getImgSize();angular.forEach(itemList,function(item){setImgSize(item,imgSize)});var containerSize=getInnerBoxElmSize(itemList,imgSize);setInnerBoxElmSize(containerSize)}scope.$breakpoint=$breakpoint,scope.triggerReload=!1;var itemList,innerBoxElm,outerBoxElm,STEP=100,TIME=5;scope.moveRight=function(){var upperBound,steps=parseInt(outerBoxElm[0].clientWidth/STEP),amountDisplay=getNumberDisplay(),imgSize=outerBoxElm[0].clientWidth/amountDisplay,currentImg=parseInt(outerBoxElm[0].scrollLeft/imgSize),topRightImg=parseInt((outerBoxElm[0].scrollLeft+outerBoxElm[0].clientWidth)/imgSize);upperBound=topRightImg+amountDisplay<itemList.length?imgSize*(currentImg+amountDisplay):getInnerBoxElmSize(itemList,imgSize)-outerBoxElm[0].clientWidth;var interval=$interval(function(){outerBoxElm[0].scrollLeft+steps>upperBound?(outerBoxElm[0].scrollLeft=upperBound,$interval.cancel(interval)):outerBoxElm[0].scrollLeft=outerBoxElm[0].scrollLeft+steps},TIME)},scope.moveLeft=function(){var lowerBound,steps=parseInt(outerBoxElm[0].clientWidth/STEP),amountDisplay=getNumberDisplay(),imgSize=outerBoxElm[0].clientWidth/amountDisplay,currentImg=parseInt(outerBoxElm[0].scrollLeft/imgSize);lowerBound=currentImg-amountDisplay>=0?imgSize*(currentImg-amountDisplay):0;var interval=$interval(function(){outerBoxElm[0].scrollLeft-steps<lowerBound?(outerBoxElm[0].scrollLeft=lowerBound,$interval.cancel(interval)):outerBoxElm[0].scrollLeft=outerBoxElm[0].scrollLeft-steps},TIME)},$timeout(function(){itemList=element.find("item"),innerBoxElm=angular.element(element.find("innerbox")),outerBoxElm=angular.element(element.find("outerbox"));var windowElm=angular.element($window);scope.$watch(function(){return $breakpoint.availUntil("sm")},function(value){STEP=value?50:100}),calculate(),scope.triggerReload=!0,windowElm.bind("resize",calculate)})}}}]),angular.module("sale").directive("salesList",["$breakpoint","$filter","$timeout","$compile",function($breakpoint,$filter,$timeout,$compile){return{templateUrl:"/modules/sales/views/saleList.client.view.html",restrict:"E",scope:{sales:"=",banner:"=?",bannerPosition:"@?"},link:function(scope,element,attrs){var BANNER_DEFAULT=4;scope.INTERVAL=5e3,scope.$breakpoint=$breakpoint,scope.featuredAvailAt=attrs.featuredAvail?attrs.featuredAvail:"lg",scope.salesList=angular.copy(scope.sales.current),scope.salesList=scope.sales.campaign.length?scope.sales.campaign.concat(scope.salesList):scope.salesList,scope.salesList.unshift(scope.sales.featured),scope.salesList=$filter("filter")(scope.salesList,function(sale){return"57dfb35fc745c410009ea120"!==sale._id}),$timeout(function(){if(scope.banner){var bannerElm=null;bannerElm=scope.banner.length>1?'<div class="col-xs-12 section-item banner"><carousel interval="INTERVAL" class=""><slide ng-repeat="slide in banner"><a target="_blank" href={{slide.url}}><img data-src="{{ slide.image.url }}" class="fluid" rio></a></slide></carousel></div>':1===scope.banner.length?'<div class="col-xs-12 section-item banner"><a target="_blank" href={{banner[0].url}}><img data-src="{{ banner[0].image.url }}" class="fluid" rio></a></div>':"<div></div>";var position=angular.isDefined(scope.bannerPosition)?parseInt(scope.bannerPosition):BANNER_DEFAULT,targetElm=angular.element(element.find("item")[position-1]);targetElm.after($compile(bannerElm)(scope))}}),scope.getSaleLink=function(sale){return sale?sale.POTD?"/products/"+$filter("seoRoute")(sale,sale.POTDId):"/sales/"+$filter("seoRoute")(sale):void 0}}}}]),angular.module("sale").filter("timeUntilStart",["$filter","Language",function($filter,Language){return function(input){if(input){var days=$filter("amDifference")(input,null,"days");if(days>0)return $filter("amDateFormat")(input,"DD/MM");var hours=$filter("amDifference")(input,null,"hours");return 8>hours?Language.getText("Today")+" 8:00am":Language.getText("Tomorrow")+" 8:00am"}}}]),angular.module("sale").filter("visibleProducts",["$filter",function($filter){return function(products,productFilter){var brands=$filter("filter")(productFilter.brands,{selected:!0});brands=Array.prototype.map.call(brands,function(brand){return brand.name});var types=$filter("filter")(productFilter.types,{selected:!0});return types=Array.prototype.map.call(types,function(type){return type.name}),$filter("filter")(products,function(product){var hasBrand=0===brands.length||brands.indexOf(product.brand)>-1,hasType=0===types.length||types.indexOf(product.type.displayName)>-1;return hasBrand&&hasType})}}]),angular.module("sale").factory("Sales",["$resource",function($resource){return $resource("/api/v1/sales/:saleId",{},{query:{isArray:!1},upcoming:{isArray:!1,method:"GET",url:"/api/v1/sales/upcoming/:saleId"},bestSeller:{isArray:!0,method:"GET",url:"/api/v1/bestseller"}})}]),angular.module("users").run(["$rootScope","$window","Authentication",function($rootScope,$window,Authentication){$window._at&&(Authentication.user&&($window._at.attributes={user:Authentication.user._id}),function(){var u="//api.aimtell.com/prod/",d=document,g=d.createElement("script"),s=d.getElementsByTagName("script")[0];g.type="text/javascript",g.async=!0,g.defer=!0,g.src=u+"trackpush.min.js",s.parentNode.insertBefore(g,s)}())}]),angular.module("users").run(["$rootScope",function($rootScope){$rootScope.$on("$stateChangeStart",function(event,toState){$rootScope.bodyClass=/^\/account/.test(toState.url)?"gray-bg":""})}]),angular.module("users").run(["$rootScope","$window",function($rootScope,$window){$window.fbAsyncInit=function(){$window.FB.init({appId:"1594476044142138",version:"v2.3"})},function(d){var js,id="facebook-jssdk",ref=d.getElementsByTagName("script")[0];d.getElementById(id)||(js=d.createElement("script"),js.id=id,js.async=!0,js.src="//connect.facebook.net/en_US/sdk.js",ref.parentNode.insertBefore(js,ref))}(document)}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").run(["$rootScope","$window","Authentication",function($rootScope,$window,Authentication){}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("account",{url:"/account",templateUrl:"/modules/users/views/account.client.view.html"}).state("accountOrders",{url:"/account/orders",templateUrl:"/modules/users/views/account-orders.client.view.html"}).state("signin",{url:"/signin",templateUrl:"/modules/users/views/signin.client.view.html",controller:"AuthenticationController",resolve:{campaign:["Campaign",function(Campaign){return Campaign.getCampaign()}]}}).state("signup",{url:"/signup/:referralCode",params:{referralCode:{value:null,squash:!0}},templateUrl:"/modules/users/views/signin.client.view.html",controller:"AuthenticationController",resolve:{campaign:["Campaign",function(Campaign){return Campaign.getCampaign()}]}}).state("reset",{url:"/reset/:token",templateUrl:"/modules/users/views/reset-password.client.view.html",controller:"AuthenticationController",resolve:{campaign:["Campaign",function(Campaign){return Campaign.getCampaign()}]}})}]),angular.module("users").controller("AccountInvitesController",["$scope","$window","Authentication","$filter","Referrals",function($scope,$window,Authentication,$filter,Referrals){$scope.referrals=Referrals.query(),$scope.referralCode=Authentication.user.referralCode,$scope.facebook=function(){$window.FB.ui({display:"popup",method:"feed",link:"https://www.leflair.vn/signup/"+$scope.referralCode,picture:"http://i.imgur.com/ISIWoHt.jpg",name:"Voucher 100,000Ä‘ cho Ä‘Æ¡n hĂ ng Ä‘áº§u tiĂªn!",description:"ÄÄƒng kĂ½ nháº­n ngay voucher mua sáº¯m hĂ ng hiá»‡u thá»i trang, má»¹ pháº©m vĂ  gia dá»¥ng vá»›i Æ°u Ä‘Ă£i +50%!",caption:"www.leflair.vn"},function(response){})},$scope.newEmails=new Array(5),$scope.emailShare=function(){$scope.errors=[],$scope.__progress=!0;var emails=$filter("filter")($scope.newEmails,function(email){return!!email});angular.forEach(emails,function(email){var referral=new Referrals({email:email});referral.$save(function(){$scope.referrals.push(referral)},function(err){err.data.soft===!0&&$scope.errors.push({email:email,message:err.data.message})})}),$scope.newEmails=new Array(5),$scope.__progress=!1},$scope.totalCredited=function(){return $scope.referrals.reduce(function(total,referral){return total+referral.credited},0)},$scope.displayTarget=function(target){return target.target&&target.target.trim().length?target.target:target.email}}]),angular.module("users").controller("AccountOrdersModalController",["$scope","$modalInstance","order",function($scope,$modalInstance,order){$scope.order=order,$scope.close=function(){$modalInstance.close()}}]),angular.module("users").controller("AccountOrdersController",["$scope","Account","$modal","$filter",function($scope,Account,$modal,$filter){$scope.orders=Account.listOrders(),$scope.variationValues=function(variations){if(!variations)return"";var values=[];return angular.forEach(variations,function(value){values.push(value)}),"( "+values.join(", ")+" )"},$scope.filterValues={open:["placed","confirmed","shipped"],past:["delivered","cancelled"]},$scope.filter="open",$scope.orderFilter=function(order){return $scope.filterValues[$scope.filter].indexOf(order.status)>-1},$scope.orderModal=function(order){$modal.open({templateUrl:"/modules/users/views/account-orders-modal.client.view.html",controller:"AccountOrdersModalController",size:"lg",resolve:{order:function(){return order}}})}}]),angular.module("users").controller("AccountController",["$scope","$q","Account","$timeout","$window","$http","AddressHelper","month","regex",function($scope,$q,Account,$timeout,$window,$http,AddressHelper,month,regex){function isBirthdayValid(birthday){return birthday&&(birthday.day||birthday.month||birthday.year)?birthday.day&&birthday.month&&birthday.year:!0}function checkValidAddress(){return $scope.account.address.shipping&&AddressHelper.isAddressValid($scope.account.address.shipping[0]).status?!(!$scope.account.address.billing||!AddressHelper.isAddressValid($scope.account.address.billing[0]).status):!1}$scope.regex=regex,Account.get().$promise.then(function(user){$scope.account=user,$scope.account.address||($scope.account.address={shipping:[],billing:[]})}),$scope.options={copyAddress:null},$scope.passwordDetails={},$scope.months=month,$scope.genderList=[{id:"F",name:"Female"},{id:"M",name:"Male"}],$scope.$on("updateCredit",function(){Account.get(function(user){$scope.account.availableCredit=user.availableCredit})}),$scope.update=function(){if($scope.isSubmitted=!0,!$scope.informationForm.$invalid){if(!isBirthdayValid($scope.userAccount.birthday))return void($scope.error="Please verify your birthday again");$scope.account=$scope.userAccount,$scope.__progress=!0,$scope.error=!1,$scope.account.$update(function(){$scope.__progress=!1,$scope.cancelUserInfo()},function(errorResponse){$scope.error=!0,$scope.__progress=!1})}},$scope.changePassword=function(){$scope.__progress=!0,$http.post("/api/v1/account/password",$scope.passwordDetails).then(function(){$scope.__progress=!1,$scope.editPassword=!1},function(errorResponse){$scope.error=!0,$scope.__progress=!1})},$scope.showEdit=function(type){$scope.isEdit=!0,$scope.editType=type,$scope.address=angular.copy($scope.account.address[type][0]),console.log($scope.account.address),console.log($scope.address),$scope.address||($scope.address={}),$scope.address.firstName||($scope.address.firstName=$scope.account.firstName),$scope.address.lastName||($scope.address.lastName=$scope.account.lastName),checkValidAddress()||($scope.options.copyAddress=!0)},$scope.cancelEdit=function(){$scope.isEdit=!1,$scope.editType=null,$scope.address=null},$scope.updateAddress=function(){var deferred=$q.defer(),checkAddress=AddressHelper.isAddressValid($scope.address);return checkAddress.status?($scope.account.address[$scope.editType][0]=angular.copy($scope.address),"shipping"===$scope.editType&&$scope.options.copyAddress===!0&&($scope.account.address.billing[0]=angular.copy($scope.address)),$scope.account.$update().then(function(){deferred.resolve()}),deferred.promise):void deferred.reject(checkAddress.err)},$scope.editUserInfo=function(){$scope.userAccount=angular.copy($scope.account),$scope.editInformation=!0},$scope.cancelUserInfo=function(){$scope.editInformation=!1,$scope.userAccount=null}}]),angular.module("users").controller("AuthenticationController",["$scope","$stateParams","$http","$location","Authentication","$state","$window","$timeout","$rootScope","campaign",function($scope,$stateParams,$http,$location,Authentication,$state,$window,$timeout,$rootScope,campaign){if($scope.campaign=campaign,$scope.authentication=Authentication,$scope.credentials={gender:"F",_referralCode:$state.params.referralCode},$state.params.referralCode&&8===$state.params.referralCode.length&&$http.get("api/v1/account/referral/email/"+$state.params.referralCode).success(function(data){$scope.emailReferral=data.email,$scope.signupStep2=!0,$scope.credentials.email=data.email,$scope.signupForm.$invalid=!1}).error(function(errorResponse){$window.location.href.endsWith("/signin")||($window.location.href="/signin")}),$scope.signupActive=!0,$scope.authentication.user)$location.path("/");else{var params=$location.search();"true"===params.noemail&&($scope.noEmailFB=!0,$scope.signupActive=!0),"true"===params.exist&&($scope.emailFBExist=!0,$scope.signupActive=!1),$scope.credentials.email=params.email?params.email:null,$location.search({})}$scope.signin=function(){$scope.signinProgress=!0,$scope.signinError=!1,$http.post("/api/v1/auth/signin",$scope.credentials).success(function(response){$scope.signinProgress=!1,$scope.authentication.user=response,$rootScope.$broadcast("cartReload"),$rootScope.reload()}).error(function(response){$scope.signinProgress=!1,$scope.signinError=response.message})},$scope.forgotPassword=function(){
$scope.forgotPasswordProgress=!0,$scope.forgotPasswordError=!1,$http.post("/api/v1/auth/forgot",{email:$scope.credentials.email}).success(function(response){$scope.forgotPasswordProgress=!1,$scope.showForgotPassword=!1,$scope.forgotPasswordSuccess=response.message}).error(function(response){$scope.forgotPasswordProgress=!1,$scope.forgotPasswordError=response.message})},$scope.signup=function(){$scope.signupProgress=!0,$http.post("/api/v1/auth/signup",$scope.credentials).success(function(response){$scope.signupProgress=!1,$scope.authentication.user=response,$rootScope.reload()}).error(function(response){$scope.signupProgress=!1,$scope.signupError=response.message})},$scope.facebook=function(){if($state.params.referralCode){var expiry=new Date;expiry.setTime(expiry.getTime()+864e5),document.cookie="referralCode="+$state.params.referralCode+";expires="+expiry.toGMTString()+";path=/"}$window.location.href="/api/auth/facebook"}}]),angular.module("users").controller("PreviewController",["$scope","Authentication","Account","$window",function($scope,Authentication,Account,$window){$scope.offset=Authentication.user.previewOffset,$scope.values=[];for(var i=0;30>=i;i+=1)$scope.values.push(i);$scope.$watch("offset",function(newValue,oldValue){newValue!==oldValue&&Account.updatePreviewOffset({offset:$scope.offset},function(){$window.location.reload()})})}]),angular.module("users").controller("ResetPasswordController",["$scope","$stateParams","$http","$location","Authentication","$rootScope","regex",function($scope,$stateParams,$http,$location,Authentication,$rootScope,regex){$scope.regex=regex,Authentication.user&&$location.path("/"),$http.get("/api/v1/auth/reset/"+$stateParams.token).success(function(){$scope.validToken=!0}).error(function(){$scope.tokenError=!0}),$scope.resetPassword=function(){return $scope.newPassword!==$scope.confirmPassword?void($scope.passwordError="Your new password entries did not match. Please double check"):($scope.__progress=!0,$scope.passwordError=null,void $http.post("/api/v1/auth/reset/"+$stateParams.token,{newPassword:$scope.newPassword}).success(function(){$scope.__progress=!1,$scope.newPassword=null,$rootScope.reload()}).error(function(errorResponse){$scope.__progress=!1,$scope.passwordError=errorResponse.data.message}))}}]),angular.module("users").controller("SignupModalController",["$scope","$modalInstance","$window","$rootScope","$http","Authentication",function($scope,$modalInstance,$window,$rootScope,$http,Authentication){$scope.credentials={},$scope.credentials={gender:"F"},$scope.facebook=function(){$window.location.href="/api/auth/facebook"},$scope.signup=function(){$scope.signupProgress=!0,$http.post("/api/v1/auth/signup",$scope.credentials).success(function(response){$scope.signupProgress=!1,Authentication.user=response,$rootScope.reload()}).error(function(response){$scope.signupProgress=!1,$scope.signupError=response.message})},$scope.signin=function(){$scope.signinProgress=!0,$scope.signinError=!1,$http.post("/api/v1/auth/signin",$scope.credentials).success(function(response){$scope.signinProgress=!1,Authentication.user=response,$rootScope.$broadcast("cartReload"),$rootScope.reload()}).error(function(response){$scope.signinProgress=!1,$scope.signinError=response.message})},$scope.resetPassword=function(){$scope.resetPasswordProgress=!0,$scope.resetPasswordError=!1,$http.post("/api/v1/auth/forgot",{email:$scope.credentials.email}).success(function(response){$scope.resetPasswordProgress=!1,$scope.mode="signin",$scope.resetPasswordSuccess=response.message}).error(function(response){$scope.resetPasswordProgress=!1,$scope.resetPasswordError=response.message})}}]),angular.module("users").directive("uiAddressForm",[function(){return{restrict:"E",templateUrl:"/modules/users/views/addressForm.client.view.html",scope:{address:"=",editType:"=",copyAddress:"=?",onCancel:"&",onAccept:"&"},controller:["$scope","regex","Address","AddressHelper",function($scope,regex,Address,AddressHelper){function loadDistricts(id){Address.query({districtId:id}).$promise.then(function(data){$scope.districts=AddressHelper.prepareName(data)})}var acceptCallback=$scope.onAccept();$scope.cancelCallback=$scope.onCancel(),$scope.regex=regex,$scope.provinces=AddressHelper.getProvinces(),$scope.selectCity=function(item){$scope.address.district=null,$scope.districts=null,$scope.address.city=item,loadDistricts(item.id)},$scope.selectDistrict=function(item){$scope.address.district=item},$scope.update=function(valid){$scope.error=null,$scope.isSubmitted=!0,valid&&($scope.isPending=!0,acceptCallback().then(function(){$scope.isPending=!1,$scope.isSubmitted=!1,$scope.cancelCallback()},function(err){$scope.isPending=!1,$scope.error=err}))},$scope.address&&$scope.address.city&&loadDistricts($scope.address.city.id)}],link:function(scope,elm,attrs){scope.isLargeForm="isLarge"in attrs}}}]),angular.module("users").directive("uiGiftcard",[function(){return{restrict:"E",templateUrl:"/modules/users/views/gift-card.client.view.html",scope:{availCredit:"=",closeTrigger:"=?"},controller:["$rootScope","$scope","GiftCard","regex",function($rootScope,$scope,GiftCard,regex){$scope.regex=regex,$scope.verify=function(valid){return valid?($scope.error=!1,$scope.__progress=!0,$scope.code=$scope.code.toUpperCase(),void GiftCard.get({giftCardCode:$scope.code},function(giftCard){$scope.__progress=!1,$scope.giftCard=giftCard},function(errorResponse){$scope.__progress=!1,$scope.error=errorResponse.data.message})):void($scope.error="Gift Card is not valid")},$scope.redeem=function(){$scope.giftCard.$use(function(){$scope.__progress=!1,$rootScope.$broadcast("updateCredit"),$scope.availCredit=$scope.availCredit+$scope.giftCard.amount,$scope.closeTrigger=!$scope.closeTrigger,$scope.giftCard=null},function(errorResponse){$scope.error=errorResponse.data.message})}}],link:function(scope,elm,attrs){scope.isLargeForm="isLarge"in attrs}}}]),angular.module("users").factory("Account",["$resource",function($resource){return $resource("/api/v1/account",{},{update:{method:"PUT"},listOrders:{method:"GET",isArray:!0,url:"/api/v1/account/orders"},updatePreviewOffset:{method:"PUT",url:"/api/v1/preview"}})}]),angular.module("users").factory("Address",["$resource",function($resource){return $resource("/api/v1/addresses/:districtId")}]).factory("AddressHelper",["regex","Language","Address",function(regex,Language,Address){function loadDistricts(id){return Address.query({districtId:id}).$promise}function isSameAddress(addr1,addr2,allowEmpty){if(allowEmpty&&!addr1&&!addr2)return!1;var result=!0;return angular.forEach(addr1,function(value,key){return"_id"===key||angular.equals(value,addr2[key])?void 0:void(result=!1)}),result}function isAddressValid(address){return address&&address.address1&&address.city&&address.district&&address.firstName&&address.lastName?regex.phone.test(address.phone)?address.taxCode&&""!==address.taxCode&&!regex.taxCode.test(address.taxCode)?{status:!1,err:"Your tax code is invalid"}:{status:!0}:{status:!1,err:"Your phone number is incorrect"}:{status:!1,err:"Please complete filling your addresss information"}}function moveItemToTop(arr,id){for(var index in arr)if(arr[index].id===id){var tempCity=arr[index];return arr.splice(index,1),arr.unshift(tempCity),arr}return arr}function setProvinces(provinces){_provincesList=provinces}function getProvinces(){return _provincesList}function prepareName(data){return angular.forEach(data,function(item){var searchName="",lowerCaseName=item.name.toLowerCase();for(var i in lowerCaseName)searchName+=Language.convertTextToEng(lowerCaseName[i],Language.VN);item.search=searchName}),data}function prepareProvince(provinces){var newProvinces=moveItemToTop(provinces,"511");return newProvinces=moveItemToTop(provinces,"4"),newProvinces=moveItemToTop(provinces,"8"),prepareName(newProvinces)}var _provincesList=null;return{isAddressValid:isAddressValid,prepareProvince:prepareProvince,setProvinces:setProvinces,getProvinces:getProvinces,prepareName:prepareName,isSameAddress:isSameAddress,loadDistricts:loadDistricts}}]).run(["Address","AddressHelper",function(Address,AddressHelper){return Address.query({districtId:"districts"}).$promise.then(function(data){AddressHelper.setProvinces(AddressHelper.prepareProvince(data))})}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("GiftCard",["$resource",function($resource){return $resource("/api/v1/giftcards/:giftCardCode",{giftCardCode:"@code"},{use:{method:"PUT"}})}]),angular.module("users").factory("Referrals",["$resource",function($resource){return $resource("/api/v1/account/referrals",{},{})}]);